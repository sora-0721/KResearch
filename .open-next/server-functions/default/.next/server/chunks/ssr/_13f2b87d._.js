module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},57526,a=>{"use strict";let b,c,d,e;var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ=a.i(37936);(f=r||(r={})).STRING="string",f.NUMBER="number",f.INTEGER="integer",f.BOOLEAN="boolean",f.ARRAY="array",f.OBJECT="object",(g=s||(s={})).LANGUAGE_UNSPECIFIED="language_unspecified",g.PYTHON="python",(h=t||(t={})).OUTCOME_UNSPECIFIED="outcome_unspecified",h.OUTCOME_OK="outcome_ok",h.OUTCOME_FAILED="outcome_failed",h.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let a$=["user","model","function","system"];(i=u||(u={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(j=v||(v={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",j.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",j.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",j.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",j.BLOCK_NONE="BLOCK_NONE",(k=w||(w={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",k.NEGLIGIBLE="NEGLIGIBLE",k.LOW="LOW",k.MEDIUM="MEDIUM",k.HIGH="HIGH",(l=x||(x={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",l.SAFETY="SAFETY",l.OTHER="OTHER",(m=y||(y={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",m.STOP="STOP",m.MAX_TOKENS="MAX_TOKENS",m.SAFETY="SAFETY",m.RECITATION="RECITATION",m.LANGUAGE="LANGUAGE",m.BLOCKLIST="BLOCKLIST",m.PROHIBITED_CONTENT="PROHIBITED_CONTENT",m.SPII="SPII",m.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",m.OTHER="OTHER",(n=z||(z={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING",(o=A||(A={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE",(p=B||(B={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",p.MODE_DYNAMIC="MODE_DYNAMIC";class a_ extends Error{constructor(a){super(`[GoogleGenerativeAI Error]: ${a}`)}}class a0 extends a_{constructor(a,b){super(a),this.response=b}}class a1 extends a_{constructor(a,b,c,d){super(a),this.status=b,this.statusText=c,this.errorDetails=d}}class a2 extends a_{}class a3 extends a_{}(q=C||(C={})).GENERATE_CONTENT="generateContent",q.STREAM_GENERATE_CONTENT="streamGenerateContent",q.COUNT_TOKENS="countTokens",q.EMBED_CONTENT="embedContent",q.BATCH_EMBED_CONTENTS="batchEmbedContents";class a4{constructor(a,b,c,d,e){this.model=a,this.task=b,this.apiKey=c,this.stream=d,this.requestOptions=e}toString(){var a,b;let c=(null==(a=this.requestOptions)?void 0:a.apiVersion)||"v1beta",d=(null==(b=this.requestOptions)?void 0:b.baseUrl)||"https://generativelanguage.googleapis.com",e=`${d}/${c}/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}}async function a5(a){var b,c;let d,e=new Headers;e.append("Content-Type","application/json"),e.append("x-goog-api-client",(c=a.requestOptions,d=[],(null==c?void 0:c.apiClient)&&d.push(c.apiClient),d.push("genai-js/0.24.1"),d.join(" "))),e.append("x-goog-api-key",a.apiKey);let f=null==(b=a.requestOptions)?void 0:b.customHeaders;if(f){if(!(f instanceof Headers))try{f=new Headers(f)}catch(a){throw new a2(`unable to convert customHeaders value ${JSON.stringify(f)} to Headers: ${a.message}`)}for(let[a,b]of f.entries()){if("x-goog-api-key"===a)throw new a2(`Cannot set reserved header name ${a}`);if("x-goog-api-client"===a)throw new a2(`Header name ${a} can only be set using the apiClient field`);e.append(a,b)}}return e}async function a6(a,b,c,d,e,f){let g=new a4(a,b,c,d,f);return{url:g.toString(),fetchOptions:Object.assign(Object.assign({},function(a){let b={};if((null==a?void 0:a.signal)!==void 0||(null==a?void 0:a.timeout)>=0){let c=new AbortController;(null==a?void 0:a.timeout)>=0&&setTimeout(()=>c.abort(),a.timeout),(null==a?void 0:a.signal)&&a.signal.addEventListener("abort",()=>{c.abort()}),b.signal=c.signal}return b}(f)),{method:"POST",headers:await a5(g),body:e})}}async function a7(a,b,c,d,e,f={},g=fetch){let{url:h,fetchOptions:i}=await a6(a,b,c,d,e,f);return a8(h,i,g)}async function a8(a,b,c=fetch){let d;try{d=await c(a,b)}catch(c){var e=c,f=a;let b=e;throw"AbortError"===b.name?(b=new a3(`Request aborted when fetching ${f.toString()}: ${e.message}`)).stack=e.stack:e instanceof a1||e instanceof a2||((b=new a_(`Error fetching from ${f.toString()}: ${e.message}`)).stack=e.stack),b}return d.ok||await a9(d,a),d}async function a9(a,b){let c,d="";try{let b=await a.json();d=b.error.message,b.error.details&&(d+=` ${JSON.stringify(b.error.details)}`,c=b.error.details)}catch(a){}throw new a1(`Error fetching from ${b.toString()}: [${a.status} ${a.statusText}] ${d}`,a.status,a.statusText,c)}function ba(a){return a.text=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),bd(a.candidates[0]))throw new a0(`${be(a)}`,a);return function(a){var b,c,d,e;let f=[];if(null==(c=null==(b=a.candidates)?void 0:b[0].content)?void 0:c.parts)for(let b of null==(e=null==(d=a.candidates)?void 0:d[0].content)?void 0:e.parts)b.text&&f.push(b.text),b.executableCode&&f.push("\n```"+b.executableCode.language+"\n"+b.executableCode.code+"\n```\n"),b.codeExecutionResult&&f.push("\n```\n"+b.codeExecutionResult.output+"\n```\n");return f.length>0?f.join(""):""}(a)}if(a.promptFeedback)throw new a0(`Text not available. ${be(a)}`,a);return""},a.functionCall=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),bd(a.candidates[0]))throw new a0(`${be(a)}`,a);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),bb(a)[0]}if(a.promptFeedback)throw new a0(`Function call not available. ${be(a)}`,a)},a.functionCalls=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),bd(a.candidates[0]))throw new a0(`${be(a)}`,a);return bb(a)}if(a.promptFeedback)throw new a0(`Function call not available. ${be(a)}`,a)},a}function bb(a){var b,c,d,e;let f=[];if(null==(c=null==(b=a.candidates)?void 0:b[0].content)?void 0:c.parts)for(let b of null==(e=null==(d=a.candidates)?void 0:d[0].content)?void 0:e.parts)b.functionCall&&f.push(b.functionCall);return f.length>0?f:void 0}let bc=[y.RECITATION,y.SAFETY,y.LANGUAGE];function bd(a){return!!a.finishReason&&bc.includes(a.finishReason)}function be(a){var b,c,d;let e="";if((!a.candidates||0===a.candidates.length)&&a.promptFeedback)e+="Response was blocked",(null==(b=a.promptFeedback)?void 0:b.blockReason)&&(e+=` due to ${a.promptFeedback.blockReason}`),(null==(c=a.promptFeedback)?void 0:c.blockReasonMessage)&&(e+=`: ${a.promptFeedback.blockReasonMessage}`);else if(null==(d=a.candidates)?void 0:d[0]){let b=a.candidates[0];bd(b)&&(e+=`Candidate was blocked due to ${b.finishReason}`,b.finishMessage&&(e+=`: ${b.finishMessage}`))}return e}function bf(a){return this instanceof bf?(this.v=a,this):new bf(a)}"function"==typeof SuppressedError&&SuppressedError;let bg=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function bh(a){let b=[],c=a.getReader();for(;;){let{done:a,value:d}=await c.read();if(a)return ba(function(a){let b=a[a.length-1],c={promptFeedback:null==b?void 0:b.promptFeedback};for(let b of a){if(b.candidates){let a=0;for(let d of b.candidates)if(c.candidates||(c.candidates=[]),c.candidates[a]||(c.candidates[a]={index:a}),c.candidates[a].citationMetadata=d.citationMetadata,c.candidates[a].groundingMetadata=d.groundingMetadata,c.candidates[a].finishReason=d.finishReason,c.candidates[a].finishMessage=d.finishMessage,c.candidates[a].safetyRatings=d.safetyRatings,d.content&&d.content.parts){c.candidates[a].content||(c.candidates[a].content={role:d.content.role||"user",parts:[]});let b={};for(let e of d.content.parts)e.text&&(b.text=e.text),e.functionCall&&(b.functionCall=e.functionCall),e.executableCode&&(b.executableCode=e.executableCode),e.codeExecutionResult&&(b.codeExecutionResult=e.codeExecutionResult),0===Object.keys(b).length&&(b.text=""),c.candidates[a].content.parts.push(b)}a++}b.usageMetadata&&(c.usageMetadata=b.usageMetadata)}return c}(b));b.push(d)}}async function bi(a,b,c,d){return function(a){let b,[c,d]=(b=a.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(a){let c="";return function d(){return b.read().then(({value:b,done:e})=>{let f;if(e)return c.trim()?void a.error(new a_("Failed to parse stream")):void a.close();let g=(c+=b).match(bg);for(;g;){try{f=JSON.parse(g[1])}catch(b){a.error(new a_(`Error parsing JSON response: "${g[1]}"`));return}a.enqueue(f),g=(c=c.substring(g[0].length)).match(bg)}return d()}).catch(a=>{let b=a;throw b.stack=a.stack,b="AbortError"===b.name?new a3("Request aborted when reading from the stream"):new a_("Error reading from the stream")})}()}})).tee();return{stream:function(a){return function(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof bf?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}(this,arguments,function*(){let b=a.getReader();for(;;){let{value:a,done:c}=yield bf(b.read());if(c)break;yield yield bf(ba(a))}})}(c),response:bh(d)}}(await a7(b,C.STREAM_GENERATE_CONTENT,a,!0,JSON.stringify(c),d))}async function bj(a,b,c,d){let e=await a7(b,C.GENERATE_CONTENT,a,!1,JSON.stringify(c),d);return{response:ba(await e.json())}}function bk(a){if(null!=a){if("string"==typeof a)return{role:"system",parts:[{text:a}]};if(a.text)return{role:"system",parts:[a]};if(a.parts)if(!a.role)return{role:"system",parts:a.parts};else return a}}function bl(a){let b=[];if("string"==typeof a)b=[{text:a}];else for(let c of a)"string"==typeof c?b.push({text:c}):b.push(c);var c=b;let d={role:"user",parts:[]},e={role:"function",parts:[]},f=!1,g=!1;for(let a of c)"functionResponse"in a?(e.parts.push(a),g=!0):(d.parts.push(a),f=!0);if(f&&g)throw new a_("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!f&&!g)throw new a_("No content is provided for sending chat message.");return f?d:e}function bm(a){let b;return b=a.contents?a:{contents:[bl(a)]},a.systemInstruction&&(b.systemInstruction=bk(a.systemInstruction)),b}let bn=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],bo={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function bp(a){var b;if(void 0===a.candidates||0===a.candidates.length)return!1;let c=null==(b=a.candidates[0])?void 0:b.content;if(void 0===c||void 0===c.parts||0===c.parts.length)return!1;for(let a of c.parts)if(void 0===a||0===Object.keys(a).length||void 0!==a.text&&""===a.text)return!1;return!0}let bq="SILENT_ERROR";class br{constructor(a,b,c,d={}){this.model=b,this.params=c,this._requestOptions=d,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=a,(null==c?void 0:c.history)&&(!function(a){let b=!1;for(let c of a){let{role:a,parts:d}=c;if(!b&&"user"!==a)throw new a_(`First content should be with role 'user', got ${a}`);if(!a$.includes(a))throw new a_(`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(a$)}`);if(!Array.isArray(d))throw new a_("Content should have 'parts' property with an array of Parts");if(0===d.length)throw new a_("Each Content should have at least one part");let e={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of d)for(let b of bn)b in a&&(e[b]+=1);let f=bo[a];for(let b of bn)if(!f.includes(b)&&e[b]>0)throw new a_(`Content with role '${a}' can't contain '${b}' part`);b=!0}}(c.history),this._history=c.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(a,b={}){var c,d,e,f,g,h;let i;await this._sendPromise;let j=bl(a),k={safetySettings:null==(c=this.params)?void 0:c.safetySettings,generationConfig:null==(d=this.params)?void 0:d.generationConfig,tools:null==(e=this.params)?void 0:e.tools,toolConfig:null==(f=this.params)?void 0:f.toolConfig,systemInstruction:null==(g=this.params)?void 0:g.systemInstruction,cachedContent:null==(h=this.params)?void 0:h.cachedContent,contents:[...this._history,j]},l=Object.assign(Object.assign({},this._requestOptions),b);return this._sendPromise=this._sendPromise.then(()=>bj(this._apiKey,this.model,k,l)).then(a=>{var b;if(bp(a.response)){this._history.push(j);let c=Object.assign({parts:[],role:"model"},null==(b=a.response.candidates)?void 0:b[0].content);this._history.push(c)}else{let b=be(a.response);b&&console.warn(`sendMessage() was unsuccessful. ${b}. Inspect response object for details.`)}i=a}).catch(a=>{throw this._sendPromise=Promise.resolve(),a}),await this._sendPromise,i}async sendMessageStream(a,b={}){var c,d,e,f,g,h;await this._sendPromise;let i=bl(a),j={safetySettings:null==(c=this.params)?void 0:c.safetySettings,generationConfig:null==(d=this.params)?void 0:d.generationConfig,tools:null==(e=this.params)?void 0:e.tools,toolConfig:null==(f=this.params)?void 0:f.toolConfig,systemInstruction:null==(g=this.params)?void 0:g.systemInstruction,cachedContent:null==(h=this.params)?void 0:h.cachedContent,contents:[...this._history,i]},k=Object.assign(Object.assign({},this._requestOptions),b),l=bi(this._apiKey,this.model,j,k);return this._sendPromise=this._sendPromise.then(()=>l).catch(a=>{throw Error(bq)}).then(a=>a.response).then(a=>{if(bp(a)){this._history.push(i);let b=Object.assign({},a.candidates[0].content);b.role||(b.role="model"),this._history.push(b)}else{let b=be(a);b&&console.warn(`sendMessageStream() was unsuccessful. ${b}. Inspect response object for details.`)}}).catch(a=>{a.message!==bq&&console.error(a)}),l}}async function bs(a,b,c,d){return(await a7(b,C.COUNT_TOKENS,a,!1,JSON.stringify(c),d)).json()}async function bt(a,b,c,d){return(await a7(b,C.EMBED_CONTENT,a,!1,JSON.stringify(c),d)).json()}async function bu(a,b,c,d){let e=c.requests.map(a=>Object.assign(Object.assign({},a),{model:b}));return(await a7(b,C.BATCH_EMBED_CONTENTS,a,!1,JSON.stringify({requests:e}),d)).json()}class bv{constructor(a,b,c={}){this.apiKey=a,this._requestOptions=c,b.model.includes("/")?this.model=b.model:this.model=`models/${b.model}`,this.generationConfig=b.generationConfig||{},this.safetySettings=b.safetySettings||[],this.tools=b.tools,this.toolConfig=b.toolConfig,this.systemInstruction=bk(b.systemInstruction),this.cachedContent=b.cachedContent}async generateContent(a,b={}){var c;let d=bm(a),e=Object.assign(Object.assign({},this._requestOptions),b);return bj(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(c=this.cachedContent)?void 0:c.name},d),e)}async generateContentStream(a,b={}){var c;let d=bm(a),e=Object.assign(Object.assign({},this._requestOptions),b);return bi(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(c=this.cachedContent)?void 0:c.name},d),e)}startChat(a){var b;return new br(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(b=this.cachedContent)?void 0:b.name},a),this._requestOptions)}async countTokens(a,b={}){let c=function(a,b){var c;let d={model:null==b?void 0:b.model,generationConfig:null==b?void 0:b.generationConfig,safetySettings:null==b?void 0:b.safetySettings,tools:null==b?void 0:b.tools,toolConfig:null==b?void 0:b.toolConfig,systemInstruction:null==b?void 0:b.systemInstruction,cachedContent:null==(c=null==b?void 0:b.cachedContent)?void 0:c.name,contents:[]},e=null!=a.generateContentRequest;if(a.contents){if(e)throw new a2("CountTokensRequest must have one of contents or generateContentRequest, not both.");d.contents=a.contents}else if(e)d=Object.assign(Object.assign({},d),a.generateContentRequest);else{let b=bl(a);d.contents=[b]}return{generateContentRequest:d}}(a,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),d=Object.assign(Object.assign({},this._requestOptions),b);return bs(this.apiKey,this.model,c,d)}async embedContent(a,b={}){let c="string"==typeof a||Array.isArray(a)?{content:bl(a)}:a,d=Object.assign(Object.assign({},this._requestOptions),b);return bt(this.apiKey,this.model,c,d)}async batchEmbedContents(a,b={}){let c=Object.assign(Object.assign({},this._requestOptions),b);return bu(this.apiKey,this.model,a,c)}}class bw{constructor(a){this.apiKey=a}getGenerativeModel(a,b){if(!a.model)throw new a_("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new bv(this.apiKey,a,b)}getGenerativeModelFromCachedContent(a,b,c){if(!a.name)throw new a2("Cached content must contain a `name` field.");if(!a.model)throw new a2("Cached content must contain a `model` field.");for(let c of["model","systemInstruction"])if((null==b?void 0:b[c])&&a[c]&&(null==b?void 0:b[c])!==a[c]){if("model"===c&&(b.model.startsWith("models/")?b.model.replace("models/",""):b.model)===(a.model.startsWith("models/")?a.model.replace("models/",""):a.model))continue;throw new a2(`Different value for "${c}" specified in modelParams (${b[c]}) and cachedContent (${a[c]})`)}let d=Object.assign(Object.assign({},b),{model:a.model,tools:a.tools,toolConfig:a.toolConfig,systemInstruction:a.systemInstruction,cachedContent:a});return new bv(this.apiKey,d,c)}}class bx{genAI;apiKey;baseUrl;constructor(a,b){this.apiKey=a,this.baseUrl=b||"https://generativelanguage.googleapis.com",this.genAI=new bw(a)}async listModels(){try{let a=await fetch(`${this.baseUrl}/v1beta/models?key=${this.apiKey}`);if(!a.ok)throw Error(`Failed to fetch models: ${a.statusText}`);return(await a.json()).models||[]}catch(a){return console.error("Gemini API List Models Error:",a),[]}}async generateText(a,b,c,d=!1,e){try{let f={model:a,systemInstruction:c};e&&(f.tools=e);let g=this.genAI.getGenerativeModel(f),h=d&&!e,i=await g.generateContent({contents:[{role:"user",parts:[{text:b}]}],generationConfig:h?{responseMimeType:"application/json"}:void 0}),j=(await i.response).text();if(d){let a=j.match(/```json\n([\s\S]*?)\n```/)||j.match(/```\n([\s\S]*?)\n```/),b=(j=a&&a[1]?a[1].trim():j.replace(/```json\n?|\n?```/g,"").trim()).indexOf("{"),c=j.indexOf("["),d=-1,e=!1;if(-1!==b&&(-1===c||b<c)?(d=b,e=!0):-1!==c&&(d=c,e=!1),-1!==d){let a=0,b=e?"{":"[",c=e?"}":"]";for(let e=d;e<j.length;e++)if(j[e]===b&&a++,j[e]===c&&a--,0===a){j=j.substring(d,e+1);break}}}return j}catch(a){throw console.error("Gemini API Error:",a),a}}}function by(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}function bz(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}let bA=function(){let{crypto:a}=globalThis;if(a?.randomUUID)return bA=a.randomUUID.bind(a),a.randomUUID();let b=new Uint8Array(1),c=a?()=>a.getRandomValues(b)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^c()&15>>a/4).toString(16))};function bB(a){return"object"==typeof a&&null!==a&&("name"in a&&"AbortError"===a.name||"message"in a&&String(a.message).includes("FetchRequestCanceledException"))}let bC=a=>{if(a instanceof Error)return a;if("object"==typeof a&&null!==a){try{if("[object Error]"===Object.prototype.toString.call(a)){let b=Error(a.message,a.cause?{cause:a.cause}:{});return a.stack&&(b.stack=a.stack),a.cause&&!b.cause&&(b.cause=a.cause),a.name&&(b.name=a.name),b}}catch{}try{return Error(JSON.stringify(a))}catch{}}return Error(a)};class bD extends Error{}class bE extends bD{constructor(a,b,c,d){super(`${bE.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.requestID=d?.get("x-request-id"),this.error=b,this.code=b?.code,this.param=b?.param,this.type=b?.type}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){if(!a||!d)return new bG({message:c,cause:bC(b)});let e=b?.error;return 400===a?new bI(a,e,c,d):401===a?new bJ(a,e,c,d):403===a?new bK(a,e,c,d):404===a?new bL(a,e,c,d):409===a?new bM(a,e,c,d):422===a?new bN(a,e,c,d):429===a?new bO(a,e,c,d):a>=500?new bP(a,e,c,d):new bE(a,e,c,d)}}class bF extends bE{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class bG extends bE{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),b&&(this.cause=b)}}class bH extends bG{constructor({message:a}={}){super({message:a??"Request timed out."})}}class bI extends bE{}class bJ extends bE{}class bK extends bE{}class bL extends bE{}class bM extends bE{}class bN extends bE{}class bO extends bE{}class bP extends bE{}class bQ extends bD{constructor(){super("Could not parse response content as the length limit was reached")}}class bR extends bD{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class bS extends Error{constructor(a){super(a)}}let bT=/^[a-z][a-z0-9+.-]*:/i,bU=a=>(bU=Array.isArray)(a),bV=bU;function bW(a){return"object"!=typeof a?{}:a??{}}function bX(a){return null!=a&&"object"==typeof a&&!Array.isArray(a)}let bY=a=>new Promise(b=>setTimeout(b,a)),bZ="6.15.0",b$=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",b_=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown";function b0(...a){let b=globalThis.ReadableStream;if(void 0===b)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new b(...a)}function b1(a){let b=Symbol.asyncIterator in a?a[Symbol.asyncIterator]():a[Symbol.iterator]();return b0({start(){},async pull(a){let{done:c,value:d}=await b.next();c?a.close():a.enqueue(d)},async cancel(){await b.return?.()}})}function b2(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function b3(a){if(null===a||"object"!=typeof a)return;if(a[Symbol.asyncIterator])return void await a[Symbol.asyncIterator]().return?.();let b=a.getReader(),c=b.cancel();b.releaseLock(),await c}let b4=({headers:a,body:b})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(b)}),b5="RFC3986",b6=a=>String(a),b7={RFC1738:a=>String(a).replace(/%20/g,"+"),RFC3986:b6},b8=(a,b)=>(b8=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(a,b),b9=(()=>{let a=[];for(let b=0;b<256;++b)a.push("%"+((b<16?"0":"")+b.toString(16)).toUpperCase());return a})();function ca(a,b){if(bU(a)){let c=[];for(let d=0;d<a.length;d+=1)c.push(b(a[d]));return c}return b(a)}let cb={brackets:a=>String(a)+"[]",comma:"comma",indices:(a,b)=>String(a)+"["+b+"]",repeat:a=>String(a)},cc=function(a,b){Array.prototype.push.apply(a,bU(b)?b:[b])},cd={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(a,b,c,d,e)=>{if(0===a.length)return a;let f=a;if("symbol"==typeof a?f=Symbol.prototype.toString.call(a):"string"!=typeof a&&(f=String(a)),"iso-8859-1"===c)return escape(f).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let g="";for(let a=0;a<f.length;a+=1024){let b=f.length>=1024?f.slice(a,a+1024):f,c=[];for(let a=0;a<b.length;++a){let d=b.charCodeAt(a);if(45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||"RFC1738"===e&&(40===d||41===d)){c[c.length]=b.charAt(a);continue}if(d<128){c[c.length]=b9[d];continue}if(d<2048){c[c.length]=b9[192|d>>6]+b9[128|63&d];continue}if(d<55296||d>=57344){c[c.length]=b9[224|d>>12]+b9[128|d>>6&63]+b9[128|63&d];continue}a+=1,d=65536+((1023&d)<<10|1023&b.charCodeAt(a)),c[c.length]=b9[240|d>>18]+b9[128|d>>12&63]+b9[128|d>>6&63]+b9[128|63&d]}g+=c.join("")}return g},encodeValuesOnly:!1,format:b5,formatter:b6,indices:!1,serializeDate:a=>(c??(c=Function.prototype.call.bind(Date.prototype.toISOString)))(a),skipNulls:!1,strictNullHandling:!1},ce={};function cf(a){let b;return(d??(d=(b=new globalThis.TextEncoder).encode.bind(b)))(a)}function cg(a){let b;return(e??(e=(b=new globalThis.TextDecoder).decode.bind(b)))(a)}class ch{constructor(){D.set(this,void 0),E.set(this,void 0),by(this,D,new Uint8Array,"f"),by(this,E,null,"f")}decode(a){let b;if(null==a)return[];let c=a instanceof ArrayBuffer?new Uint8Array(a):"string"==typeof a?cf(a):a;by(this,D,function(a){let b=0;for(let c of a)b+=c.length;let c=new Uint8Array(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return c}([bz(this,D,"f"),c]),"f");let d=[];for(;null!=(b=function(a,b){for(let c=b??0;c<a.length;c++){if(10===a[c])return{preceding:c,index:c+1,carriage:!1};if(13===a[c])return{preceding:c,index:c+1,carriage:!0}}return null}(bz(this,D,"f"),bz(this,E,"f")));){if(b.carriage&&null==bz(this,E,"f")){by(this,E,b.index,"f");continue}if(null!=bz(this,E,"f")&&(b.index!==bz(this,E,"f")+1||b.carriage)){d.push(cg(bz(this,D,"f").subarray(0,bz(this,E,"f")-1))),by(this,D,bz(this,D,"f").subarray(bz(this,E,"f")),"f"),by(this,E,null,"f");continue}let a=null!==bz(this,E,"f")?b.preceding-1:b.preceding,c=cg(bz(this,D,"f").subarray(0,a));d.push(c),by(this,D,bz(this,D,"f").subarray(b.index),"f"),by(this,E,null,"f")}return d}flush(){return bz(this,D,"f").length?this.decode("\n"):[]}}D=new WeakMap,E=new WeakMap,ch.NEWLINE_CHARS=new Set(["\n","\r"]),ch.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ci={off:0,error:200,warn:300,info:400,debug:500},cj=(a,b,c)=>{if(a){if(Object.prototype.hasOwnProperty.call(ci,a))return a;co(c).warn(`${b} was set to ${JSON.stringify(a)}, expected one of ${JSON.stringify(Object.keys(ci))}`)}};function ck(){}function cl(a,b,c){return!b||ci[a]>ci[c]?ck:b[a].bind(b)}let cm={error:ck,warn:ck,info:ck,debug:ck},cn=new WeakMap;function co(a){let b=a.logger,c=a.logLevel??"off";if(!b)return cm;let d=cn.get(b);if(d&&d[0]===c)return d[1];let e={error:cl("error",b,c),warn:cl("warn",b,c),info:cl("info",b,c),debug:cl("debug",b,c)};return cn.set(b,[c,e]),e}let cp=a=>(a.options&&(a.options={...a.options},delete a.options.headers),a.headers&&(a.headers=Object.fromEntries((a.headers instanceof Headers?[...a.headers]:Object.entries(a.headers)).map(([a,b])=>[a,"authorization"===a.toLowerCase()||"cookie"===a.toLowerCase()||"set-cookie"===a.toLowerCase()?"***":b]))),"retryOfRequestLogID"in a&&(a.retryOfRequestLogID&&(a.retryOf=a.retryOfRequestLogID),delete a.retryOfRequestLogID),a);class cq{constructor(a,b,c){this.iterator=a,F.set(this,void 0),this.controller=b,by(this,F,c,"f")}static fromSSEResponse(a,b,c){let d=!1,e=c?co(c):console;async function*f(){if(d)throw new bD("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let c=!1;try{for await(let d of cr(a,b))if(!c){if(d.data.startsWith("[DONE]")){c=!0;continue}if(null!==d.event&&d.event.startsWith("thread.")){let a;try{a=JSON.parse(d.data)}catch(a){throw console.error("Could not parse message into JSON:",d.data),console.error("From chunk:",d.raw),a}if("error"==d.event)throw new bE(void 0,a.error,a.message,void 0);yield{event:d.event,data:a}}else{let b;try{b=JSON.parse(d.data)}catch(a){throw e.error("Could not parse message into JSON:",d.data),e.error("From chunk:",d.raw),a}if(b&&b.error)throw new bE(void 0,b.error,void 0,a.headers);yield b}}c=!0}catch(a){if(bB(a))return;throw a}finally{c||b.abort()}}return new cq(f,b,c)}static fromReadableStream(a,b,c){let d=!1;async function*e(){let b=new ch;for await(let c of b2(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new cq(async function*(){if(d)throw new bD("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let a=!1;try{for await(let b of e())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(bB(a))return;throw a}finally{a||b.abort()}},b,c)}[(F=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new cq(()=>d(a),this.controller,bz(this,F,"f")),new cq(()=>d(b),this.controller,bz(this,F,"f"))]}toReadableStream(){let a,b=this;return b0({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:c,done:d}=await a.next();if(d)return b.close();let e=cf(JSON.stringify(c)+"\n");b.enqueue(e)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}async function*cr(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new bD("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new bD("Attempted to iterate over a response with no body")}let c=new ct,d=new ch;for await(let b of cs(b2(a.body)))for(let a of d.decode(b)){let b=c.decode(a);b&&(yield b)}for(let a of d.flush()){let b=c.decode(a);b&&(yield b)}}async function*cs(a){let b=new Uint8Array;for await(let c of a){let a;if(null==c)continue;let d=c instanceof ArrayBuffer?new Uint8Array(c):"string"==typeof c?cf(c):c,e=new Uint8Array(b.length+d.length);for(e.set(b),e.set(d,b.length),b=e;-1!==(a=function(a){for(let b=0;b<a.length-1;b++){if(10===a[b]&&10===a[b+1]||13===a[b]&&13===a[b+1])return b+2;if(13===a[b]&&10===a[b+1]&&b+3<a.length&&13===a[b+2]&&10===a[b+3])return b+4}return -1}(b));)yield b.slice(0,a),b=b.slice(a)}b.length>0&&(yield b)}class ct{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){var b;let c;if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[d,e,f]=-1!==(c=(b=a).indexOf(":"))?[b.substring(0,c),":",b.substring(c+1)]:[b,"",""];return f.startsWith(" ")&&(f=f.substring(1)),"event"===d?this.event=f:"data"===d&&this.data.push(f),null}}async function cu(a,b){let{response:c,requestLogID:d,retryOfRequestLogID:e,startTime:f}=b,g=await (async()=>{if(b.options.stream)return(co(a).debug("response",c.status,c.url,c.headers,c.body),b.options.__streamClass)?b.options.__streamClass.fromSSEResponse(c,b.controller,a):cq.fromSSEResponse(c,b.controller,a);if(204===c.status)return null;if(b.options.__binaryResponse)return c;let d=c.headers.get("content-type"),e=d?.split(";")[0]?.trim();return e?.includes("application/json")||e?.endsWith("+json")?cv(await c.json(),c):await c.text()})();return co(a).debug(`[${d}] response parsed`,cp({retryOfRequestLogID:e,url:c.url,status:c.status,body:g,durationMs:Date.now()-f})),g}function cv(a,b){return!a||"object"!=typeof a||Array.isArray(a)?a:Object.defineProperty(a,"_request_id",{value:b.headers.get("x-request-id"),enumerable:!1})}class cw extends Promise{constructor(a,b,c=cu){super(a=>{a(null)}),this.responsePromise=b,this.parseResponse=c,G.set(this,void 0),by(this,G,a,"f")}_thenUnwrap(a){return new cw(bz(this,G,"f"),this.responsePromise,async(b,c)=>cv(a(await this.parseResponse(b,c),c),c.response))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b,request_id:b.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(a=>this.parseResponse(bz(this,G,"f"),a))),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}G=new WeakMap;class cx{constructor(a,b,c,d){H.set(this,void 0),by(this,H,a,"f"),this.options=d,this.response=b,this.body=c}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let a=this.nextPageRequestOptions();if(!a)throw new bD("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await bz(this,H,"f").requestAPIList(this.constructor,a)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(H=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let b of a.getPaginatedItems())yield b}}class cy extends cw{constructor(a,b,c){super(a,b,async(a,b)=>new c(a,b.response,await cu(a,b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}class cz extends cx{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.object=c.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class cA extends cx{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let a=this.getPaginatedItems(),b=a[a.length-1]?.id;return b?{...this.options,query:{...bW(this.options.query),after:b}}:null}}class cB extends cx{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1,this.last_id=c.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let a=this.last_id;return a?{...this.options,query:{...bW(this.options.query),after:a}}:null}}let cC=()=>{if("undefined"==typeof File){let{process:a}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof a?.versions?.node&&20>parseInt(a.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function cD(a,b,c){return cC(),new File(a,b??"unknown_file",c)}function cE(a){return("object"==typeof a&&null!==a&&("name"in a&&a.name&&String(a.name)||"url"in a&&a.url&&String(a.url)||"filename"in a&&a.filename&&String(a.filename)||"path"in a&&a.path&&String(a.path))||"").split(/[\\/]/).pop()||void 0}let cF=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],cG=async(a,b)=>cL(a.body)?{...a,body:await cJ(a.body,b)}:a,cH=async(a,b)=>({...a,body:await cJ(a.body,b)}),cI=new WeakMap,cJ=async(a,b)=>{if(!await function(a){let b="function"==typeof a?a:a.fetch,c=cI.get(b);if(c)return c;let d=(async()=>{try{let a="Response"in b?b.Response:(await b("data:,")).constructor,c=new FormData;if(c.toString()===await new a(c).text())return!1;return!0}catch{return!0}})();return cI.set(b,d),d}(b))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let c=new FormData;return await Promise.all(Object.entries(a||{}).map(([a,b])=>cM(c,a,b))),c},cK=a=>a instanceof Blob&&"name"in a,cL=a=>{if("object"==typeof a&&null!==a&&(a instanceof Response||cF(a)||cK(a)))return!0;if(Array.isArray(a))return a.some(cL);if(a&&"object"==typeof a){for(let b in a)if(cL(a[b]))return!0}return!1},cM=async(a,b,c)=>{if(void 0!==c){if(null==c)throw TypeError(`Received null for "${b}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)a.append(b,String(c));else if(c instanceof Response)a.append(b,cD([await c.blob()],cE(c)));else if(cF(c))a.append(b,cD([await new Response(b1(c)).blob()],cE(c)));else if(cK(c))a.append(b,c,cE(c));else if(Array.isArray(c))await Promise.all(c.map(c=>cM(a,b+"[]",c)));else if("object"==typeof c)await Promise.all(Object.entries(c).map(([c,d])=>cM(a,`${b}[${c}]`,d)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${c} instead`)}},cN=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer;async function cO(a,b,c){let d,e;if(cC(),null!=(d=a=await a)&&"object"==typeof d&&"string"==typeof d.name&&"number"==typeof d.lastModified&&cN(d))return a instanceof File?a:cD([await a.arrayBuffer()],a.name);if(null!=(e=a)&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob){let d=await a.blob();return b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()),cD(await cP(d),b,c)}let f=await cP(a);if(b||(b=cE(a)),!c?.type){let a=f.find(a=>"object"==typeof a&&"type"in a&&a.type);"string"==typeof a&&(c={...c,type:a})}return cD(f,b,c)}async function cP(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(cN(a))b.push(a instanceof Blob?a:await a.arrayBuffer());else if(cF(a))for await(let c of a)b.push(...await cP(c));else{let b=a?.constructor?.name;throw Error(`Unexpected data type: ${typeof a}${b?`; constructor: ${b}`:""}${function(a){if("object"!=typeof a||null===a)return"";let b=Object.getOwnPropertyNames(a);return`; props: [${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`)}return b}class cQ{constructor(a){this._client=a}}function cR(a){return a.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let cS=Object.freeze(Object.create(null)),cT=((a=cR)=>function(b,...c){let d;if(1===b.length)return b[0];let e=!1,f=[],g=b.reduce((b,d,g)=>{/[?#]/.test(d)&&(e=!0);let h=c[g],i=(e?encodeURIComponent:a)(""+h);return g!==c.length&&(null==h||"object"==typeof h&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??cS)??cS)?.toString)&&(i=h+"",f.push({start:b.length+d.length,length:i.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),b+d+(g===c.length?"":i)},""),h=g.split(/[?#]/,1)[0],i=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(d=i.exec(h));)f.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(f.sort((a,b)=>a.start-b.start),f.length>0){let a=0,b=f.reduce((b,c)=>{let d=" ".repeat(c.start-a),e="^".repeat(c.length);return a=c.start+c.length,b+d+e},"");throw new bD(`Path parameters result in path with invalid segments:
${f.map(a=>a.error).join("\n")}
${g}
${b}`)}return g})(cR);class cU extends cQ{list(a,b={},c){return this._client.getAPIList(cT`/chat/completions/${a}/messages`,cA,{query:b,...c})}}function cV(a){return void 0!==a&&"function"in a&&void 0!==a.function}function cW(a){return a?.$brand==="auto-parseable-response-format"}function cX(a){return a?.$brand==="auto-parseable-tool"}function cY(a,b){let c=a.choices.map(a=>{var c,d;if("length"===a.finish_reason)throw new bQ;if("content_filter"===a.finish_reason)throw new bR;return c$(a.message.tool_calls),{...a,message:{...a.message,...a.message.tool_calls?{tool_calls:a.message.tool_calls?.map(a=>{var c,d;let e;return c=b,d=a,e=c.tools?.find(a=>cV(a)&&a.function?.name===d.function.name),{...d,function:{...d.function,parsed_arguments:cX(e)?e.$parseRaw(d.function.arguments):e?.function.strict?JSON.parse(d.function.arguments):null}}})??void 0}:void 0,parsed:a.message.content&&!a.message.refusal?(c=b,d=a.message.content,c.response_format?.type!=="json_schema"?null:c.response_format?.type==="json_schema"?"$parseRaw"in c.response_format?c.response_format.$parseRaw(d):JSON.parse(d):null):null}}});return{...a,choices:c}}function cZ(a){return!!cW(a.response_format)||(a.tools?.some(a=>cX(a)||"function"===a.type&&!0===a.function.strict)??!1)}function c$(a){for(let b of a||[])if("function"!==b.type)throw new bD(`Currently only \`function\` tool calls are supported; Received \`${b.type}\``)}let c_=a=>a?.role==="assistant",c0=a=>a?.role==="tool";class c1{constructor(){I.add(this),this.controller=new AbortController,J.set(this,void 0),K.set(this,()=>{}),L.set(this,()=>{}),M.set(this,void 0),N.set(this,()=>{}),O.set(this,()=>{}),P.set(this,{}),Q.set(this,!1),R.set(this,!1),S.set(this,!1),T.set(this,!1),by(this,J,new Promise((a,b)=>{by(this,K,a,"f"),by(this,L,b,"f")}),"f"),by(this,M,new Promise((a,b)=>{by(this,N,a,"f"),by(this,O,b,"f")}),"f"),bz(this,J,"f").catch(()=>{}),bz(this,M,"f").catch(()=>{})}_run(a){setTimeout(()=>{a().then(()=>{this._emitFinal(),this._emit("end")},bz(this,I,"m",U).bind(this))},0)}_connected(){this.ended||(bz(this,K,"f").call(this),this._emit("connect"))}get ended(){return bz(this,Q,"f")}get errored(){return bz(this,R,"f")}get aborted(){return bz(this,S,"f")}abort(){this.controller.abort()}on(a,b){return(bz(this,P,"f")[a]||(bz(this,P,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=bz(this,P,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(bz(this,P,"f")[a]||(bz(this,P,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{by(this,T,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){by(this,T,!0,"f"),await bz(this,M,"f")}_emit(a,...b){if(bz(this,Q,"f"))return;"end"===a&&(by(this,Q,!0,"f"),bz(this,N,"f").call(this));let c=bz(this,P,"f")[a];if(c&&(bz(this,P,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];bz(this,T,"f")||c?.length||Promise.reject(a),bz(this,L,"f").call(this,a),bz(this,O,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];bz(this,T,"f")||c?.length||Promise.reject(a),bz(this,L,"f").call(this,a),bz(this,O,"f").call(this,a),this._emit("end")}}_emitFinal(){}}J=new WeakMap,K=new WeakMap,L=new WeakMap,M=new WeakMap,N=new WeakMap,O=new WeakMap,P=new WeakMap,Q=new WeakMap,R=new WeakMap,S=new WeakMap,T=new WeakMap,I=new WeakSet,U=function(a){if(by(this,R,!0,"f"),a instanceof Error&&"AbortError"===a.name&&(a=new bF),a instanceof bF)return by(this,S,!0,"f"),this._emit("abort",a);if(a instanceof bD)return this._emit("error",a);if(a instanceof Error){let b=new bD(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new bD(String(a)))};class c2 extends c1{constructor(){super(...arguments),V.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(a){this._chatCompletions.push(a),this._emit("chatCompletion",a);let b=a.choices[0]?.message;return b&&this._addMessage(b),a}_addMessage(a,b=!0){if("content"in a||(a.content=null),this.messages.push(a),b){if(this._emit("message",a),c0(a)&&a.content)this._emit("functionToolCallResult",a.content);else if(c_(a)&&a.tool_calls)for(let b of a.tool_calls)"function"===b.type&&this._emit("functionToolCall",b.function)}}async finalChatCompletion(){await this.done();let a=this._chatCompletions[this._chatCompletions.length-1];if(!a)throw new bD("stream ended without producing a ChatCompletion");return a}async finalContent(){return await this.done(),bz(this,V,"m",W).call(this)}async finalMessage(){return await this.done(),bz(this,V,"m",X).call(this)}async finalFunctionToolCall(){return await this.done(),bz(this,V,"m",Y).call(this)}async finalFunctionToolCallResult(){return await this.done(),bz(this,V,"m",Z).call(this)}async totalUsage(){return await this.done(),bz(this,V,"m",$).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let a=this._chatCompletions[this._chatCompletions.length-1];a&&this._emit("finalChatCompletion",a);let b=bz(this,V,"m",X).call(this);b&&this._emit("finalMessage",b);let c=bz(this,V,"m",W).call(this);c&&this._emit("finalContent",c);let d=bz(this,V,"m",Y).call(this);d&&this._emit("finalFunctionToolCall",d);let e=bz(this,V,"m",Z).call(this);null!=e&&this._emit("finalFunctionToolCallResult",e),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",bz(this,V,"m",$).call(this))}async _createChatCompletion(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),bz(this,V,"m",_).call(this,b);let e=await a.chat.completions.create({...b,stream:!1},{...c,signal:this.controller.signal});return this._connected(),this._addChatCompletion(cY(e,b))}async _runChatCompletion(a,b,c){for(let a of b.messages)this._addMessage(a,!1);return await this._createChatCompletion(a,b,c)}async _runTools(a,b,c){let d="tool",{tool_choice:e="auto",stream:f,...g}=b,h="string"!=typeof e&&"function"===e.type&&e?.function?.name,{maxChatCompletions:i=10}=c||{},j=b.tools.map(a=>{if(cX(a)){if(!a.$callback)throw new bD("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:a.$callback,name:a.function.name,description:a.function.description||"",parameters:a.function.parameters,parse:a.$parseRaw,strict:!0}}}return a}),k={};for(let a of j)"function"===a.type&&(k[a.function.name||a.function.function.name]=a.function);let l="tools"in b?j.map(a=>"function"===a.type?{type:"function",function:{name:a.function.name||a.function.function.name,parameters:a.function.parameters,description:a.function.description,strict:a.function.strict}}:a):void 0;for(let a of b.messages)this._addMessage(a,!1);for(let b=0;b<i;++b){let b=await this._createChatCompletion(a,{...g,tool_choice:e,tools:l,messages:[...this.messages]},c),f=b.choices[0]?.message;if(!f)throw new bD("missing message in ChatCompletion response");if(!f.tool_calls?.length)break;for(let a of f.tool_calls){let b;if("function"!==a.type)continue;let c=a.id,{name:e,arguments:f}=a.function,g=k[e];if(g){if(h&&h!==e){let a=`Invalid tool_call: ${JSON.stringify(e)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}}else{let a=`Invalid tool_call: ${JSON.stringify(e)}. Available options are: ${Object.keys(k).map(a=>JSON.stringify(a)).join(", ")}. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}try{b="function"==typeof g.parse?await g.parse(f):f}catch(b){let a=b instanceof Error?b.message:String(b);this._addMessage({role:d,tool_call_id:c,content:a});continue}let i=await g.function(b,this),j=bz(this,V,"m",aa).call(this,i);if(this._addMessage({role:d,tool_call_id:c,content:j}),h)return}}}}V=new WeakSet,W=function(){return bz(this,V,"m",X).call(this).content??null},X=function(){let a=this.messages.length;for(;a-- >0;){let b=this.messages[a];if(c_(b))return{...b,content:b.content??null,refusal:b.refusal??null}}throw new bD("stream ended without producing a ChatCompletionMessage with role=assistant")},Y=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(c_(b)&&b?.tool_calls?.length)return b.tool_calls.filter(a=>"function"===a.type).at(-1)?.function}},Z=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(c0(b)&&null!=b.content&&"string"==typeof b.content&&this.messages.some(a=>"assistant"===a.role&&a.tool_calls?.some(a=>"function"===a.type&&a.id===b.tool_call_id)))return b.content}},$=function(){let a={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:b}of this._chatCompletions)b&&(a.completion_tokens+=b.completion_tokens,a.prompt_tokens+=b.prompt_tokens,a.total_tokens+=b.total_tokens);return a},_=function(a){if(null!=a.n&&a.n>1)throw new bD("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},aa=function(a){return"string"==typeof a?a:void 0===a?"undefined":JSON.stringify(a)};class c3 extends c2{static runTools(a,b,c){let d=new c3,e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}_addMessage(a,b=!0){super._addMessage(a,b),c_(a)&&a.content&&this._emit("content",a.content)}}let c4=511;class c5 extends Error{}class c6 extends Error{}let c7=a=>(function(a,b=c4){var c,d;let e,f,g,h,i,j,k,l,m,n;if("string"!=typeof a)throw TypeError(`expecting str, got ${typeof a}`);if(!a.trim())throw Error(`${a} is empty`);return c=a.trim(),d=b,e=c.length,f=0,g=a=>{throw new c5(`${a} at position ${f}`)},h=a=>{throw new c6(`${a} at position ${f}`)},i=()=>(n(),f>=e&&g("Unexpected end of input"),'"'===c[f])?j():"{"===c[f]?k():"["===c[f]?l():"null"===c.substring(f,f+4)||16&d&&e-f<4&&"null".startsWith(c.substring(f))?(f+=4,null):"true"===c.substring(f,f+4)||32&d&&e-f<4&&"true".startsWith(c.substring(f))?(f+=4,!0):"false"===c.substring(f,f+5)||32&d&&e-f<5&&"false".startsWith(c.substring(f))?(f+=5,!1):"Infinity"===c.substring(f,f+8)||128&d&&e-f<8&&"Infinity".startsWith(c.substring(f))?(f+=8,1/0):"-Infinity"===c.substring(f,f+9)||256&d&&1<e-f&&e-f<9&&"-Infinity".startsWith(c.substring(f))?(f+=9,-1/0):"NaN"===c.substring(f,f+3)||64&d&&e-f<3&&"NaN".startsWith(c.substring(f))?(f+=3,NaN):m(),j=()=>{let a=f,b=!1;for(f++;f<e&&('"'!==c[f]||b&&"\\"===c[f-1]);)b="\\"===c[f]&&!b,f++;if('"'==c.charAt(f))try{return JSON.parse(c.substring(a,++f-Number(b)))}catch(a){h(String(a))}else if(1&d)try{return JSON.parse(c.substring(a,f-Number(b))+'"')}catch(b){return JSON.parse(c.substring(a,c.lastIndexOf("\\"))+'"')}g("Unterminated string literal")},k=()=>{f++,n();let a={};try{for(;"}"!==c[f];){if(n(),f>=e&&8&d)return a;let b=j();n(),f++;try{let c=i();Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}catch(b){if(8&d)return a;throw b}n(),","===c[f]&&f++}}catch(b){if(8&d)return a;g("Expected '}' at end of object")}return f++,a},l=()=>{f++;let a=[];try{for(;"]"!==c[f];)a.push(i()),n(),","===c[f]&&f++}catch(b){if(4&d)return a;g("Expected ']' at end of array")}return f++,a},m=()=>{if(0===f){"-"===c&&2&d&&g("Not sure what '-' is");try{return JSON.parse(c)}catch(a){if(2&d)try{if("."===c[c.length-1])return JSON.parse(c.substring(0,c.lastIndexOf(".")));return JSON.parse(c.substring(0,c.lastIndexOf("e")))}catch(a){}h(String(a))}}let a=f;for("-"===c[f]&&f++;c[f]&&!",]}".includes(c[f]);)f++;f!=e||2&d||g("Unterminated number literal");try{return JSON.parse(c.substring(a,f))}catch(b){"-"===c.substring(a,f)&&2&d&&g("Not sure what '-' is");try{return JSON.parse(c.substring(a,c.lastIndexOf("e")))}catch(a){h(String(a))}}},n=()=>{for(;f<e&&" \n\r	".includes(c[f]);)f++},i()})(a,2^c4);class c8 extends c2{constructor(a){super(),ab.add(this),ac.set(this,void 0),ad.set(this,void 0),ae.set(this,void 0),by(this,ac,a,"f"),by(this,ad,[],"f")}get currentChatCompletionSnapshot(){return bz(this,ae,"f")}static fromReadableStream(a){let b=new c8(null);return b._run(()=>b._fromReadableStream(a)),b}static createChatCompletion(a,b,c){let d=new c8(b);return d._run(()=>d._runChatCompletion(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createChatCompletion(a,b,c){super._createChatCompletion;let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),bz(this,ab,"m",af).call(this);let e=await a.chat.completions.create({...b,stream:!0},{...c,signal:this.controller.signal});for await(let a of(this._connected(),e))bz(this,ab,"m",ah).call(this,a);if(e.controller.signal?.aborted)throw new bF;return this._addChatCompletion(bz(this,ab,"m",ak).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),bz(this,ab,"m",af).call(this),this._connected();let e=cq.fromReadableStream(a,this.controller);for await(let a of e)c&&c!==a.id&&this._addChatCompletion(bz(this,ab,"m",ak).call(this)),bz(this,ab,"m",ah).call(this,a),c=a.id;if(e.controller.signal?.aborted)throw new bF;return this._addChatCompletion(bz(this,ab,"m",ak).call(this))}[(ac=new WeakMap,ad=new WeakMap,ae=new WeakMap,ab=new WeakSet,af=function(){this.ended||by(this,ae,void 0,"f")},ag=function(a){let b=bz(this,ad,"f")[a.index];return b||(b={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},bz(this,ad,"f")[a.index]=b),b},ah=function(a){if(this.ended)return;let b=bz(this,ab,"m",am).call(this,a);for(let c of(this._emit("chunk",a,b),a.choices)){let a=b.choices[c.index];null!=c.delta.content&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",c.delta.content,a.message.content),this._emit("content.delta",{delta:c.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),null!=c.delta.refusal&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:c.delta.refusal,snapshot:a.message.refusal}),c.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:c.logprobs?.content,snapshot:a.logprobs?.content??[]}),c.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:c.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let d=bz(this,ab,"m",ag).call(this,a);for(let b of(a.finish_reason&&(bz(this,ab,"m",aj).call(this,a),null!=d.current_tool_call_index&&bz(this,ab,"m",ai).call(this,a,d.current_tool_call_index)),c.delta.tool_calls??[]))d.current_tool_call_index!==b.index&&(bz(this,ab,"m",aj).call(this,a),null!=d.current_tool_call_index&&bz(this,ab,"m",ai).call(this,a,d.current_tool_call_index)),d.current_tool_call_index=b.index;for(let b of c.delta.tool_calls??[]){let c=a.message.tool_calls?.[b.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:b.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:b.function?.arguments??""}):db(c?.type))}}},ai=function(a,b){if(bz(this,ab,"m",ag).call(this,a).done_tool_calls.has(b))return;let c=a.message.tool_calls?.[b];if(!c)throw Error("no tool call snapshot");if(!c.type)throw Error("tool call snapshot missing `type`");if("function"===c.type){let a=bz(this,ac,"f")?.tools?.find(a=>cV(a)&&a.function.name===c.function.name);this._emit("tool_calls.function.arguments.done",{name:c.function.name,index:b,arguments:c.function.arguments,parsed_arguments:cX(a)?a.$parseRaw(c.function.arguments):a?.function.strict?JSON.parse(c.function.arguments):null})}else db(c.type)},aj=function(a){let b=bz(this,ab,"m",ag).call(this,a);if(a.message.content&&!b.content_done){b.content_done=!0;let c=bz(this,ab,"m",al).call(this);this._emit("content.done",{content:a.message.content,parsed:c?c.$parseRaw(a.message.content):null})}a.message.refusal&&!b.refusal_done&&(b.refusal_done=!0,this._emit("refusal.done",{refusal:a.message.refusal})),a.logprobs?.content&&!b.logprobs_content_done&&(b.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:a.logprobs.content})),a.logprobs?.refusal&&!b.logprobs_refusal_done&&(b.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:a.logprobs.refusal}))},ak=function(){if(this.ended)throw new bD("stream has ended, this shouldn't happen");let a=bz(this,ae,"f");if(!a)throw new bD("request ended without sending any chunks");return by(this,ae,void 0,"f"),by(this,ad,[],"f"),function(a,b){var c;let{id:d,choices:e,created:f,model:g,system_fingerprint:h,...i}=a;return c={...i,id:d,choices:e.map(({message:b,finish_reason:c,index:d,logprobs:e,...f})=>{if(!c)throw new bD(`missing finish_reason for choice ${d}`);let{content:g=null,function_call:h,tool_calls:i,...j}=b,k=b.role;if(!k)throw new bD(`missing role for choice ${d}`);if(h){let{arguments:a,name:i}=h;if(null==a)throw new bD(`missing function_call.arguments for choice ${d}`);if(!i)throw new bD(`missing function_call.name for choice ${d}`);return{...f,message:{content:g,function_call:{arguments:a,name:i},role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}return i?{...f,index:d,finish_reason:c,logprobs:e,message:{...j,role:k,content:g,refusal:b.refusal??null,tool_calls:i.map((b,c)=>{let{function:e,type:f,id:g,...h}=b,{arguments:i,name:j,...k}=e||{};if(null==g)throw new bD(`missing choices[${d}].tool_calls[${c}].id
${c9(a)}`);if(null==f)throw new bD(`missing choices[${d}].tool_calls[${c}].type
${c9(a)}`);if(null==j)throw new bD(`missing choices[${d}].tool_calls[${c}].function.name
${c9(a)}`);if(null==i)throw new bD(`missing choices[${d}].tool_calls[${c}].function.arguments
${c9(a)}`);return{...h,id:g,type:f,function:{...k,name:j,arguments:i}}})}}:{...f,message:{...j,content:g,role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}),created:f,model:g,object:"chat.completion",...h?{system_fingerprint:h}:{}},b&&cZ(b)?cY(c,b):{...c,choices:c.choices.map(a=>(c$(a.message.tool_calls),{...a,message:{...a.message,parsed:null,...a.message.tool_calls?{tool_calls:a.message.tool_calls}:void 0}}))}}(a,bz(this,ac,"f"))},al=function(){let a=bz(this,ac,"f")?.response_format;return cW(a)?a:null},am=function(a){var b,c,d,e;let f=bz(this,ae,"f"),{choices:g,...h}=a;for(let{delta:g,finish_reason:i,index:j,logprobs:k=null,...l}of(f?Object.assign(f,h):f=by(this,ae,{...h,choices:[]},"f"),a.choices)){let a=f.choices[j];if(a||(a=f.choices[j]={finish_reason:i,index:j,message:{},logprobs:k,...l}),k)if(a.logprobs){let{content:d,refusal:e,...f}=k;da(f),Object.assign(a.logprobs,f),d&&((b=a.logprobs).content??(b.content=[]),a.logprobs.content.push(...d)),e&&((c=a.logprobs).refusal??(c.refusal=[]),a.logprobs.refusal.push(...e))}else a.logprobs=Object.assign({},k);if(i&&(a.finish_reason=i,bz(this,ac,"f")&&cZ(bz(this,ac,"f")))){if("length"===i)throw new bQ;if("content_filter"===i)throw new bR}if(Object.assign(a,l),!g)continue;let{content:h,refusal:m,function_call:n,role:o,tool_calls:p,...q}=g;if(da(q),Object.assign(a.message,q),m&&(a.message.refusal=(a.message.refusal||"")+m),o&&(a.message.role=o),n&&(a.message.function_call?(n.name&&(a.message.function_call.name=n.name),n.arguments&&((d=a.message.function_call).arguments??(d.arguments=""),a.message.function_call.arguments+=n.arguments)):a.message.function_call=n),h&&(a.message.content=(a.message.content||"")+h,!a.message.refusal&&bz(this,ab,"m",al).call(this)&&(a.message.parsed=c7(a.message.content))),p)for(let{index:b,id:c,type:d,function:f,...g}of(a.message.tool_calls||(a.message.tool_calls=[]),p)){let h=(e=a.message.tool_calls)[b]??(e[b]={});Object.assign(h,g),c&&(h.id=c),d&&(h.type=d),f&&(h.function??(h.function={name:f.name??"",arguments:""})),f?.name&&(h.function.name=f.name),f?.arguments&&(h.function.arguments+=f.arguments,function(a,b){if(!a||!("tools"in a)||!a.tools)return!1;let c=a.tools?.find(a=>cV(a)&&a.function?.name===b.function.name);return cV(c)&&(cX(c)||c?.function.strict||!1)}(bz(this,ac,"f"),h)&&(h.function.parsed_arguments=c7(h.function.arguments)))}}return f},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("chunk",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new cq(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function c9(a){return JSON.stringify(a)}function da(a){}function db(a){}class dc extends c8{static fromReadableStream(a){let b=new dc(null);return b._run(()=>b._fromReadableStream(a)),b}static runTools(a,b,c){let d=new dc(b),e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}}class dd extends cQ{constructor(){super(...arguments),this.messages=new cU(this._client)}create(a,b){return this._client.post("/chat/completions",{body:a,...b,stream:a.stream??!1})}retrieve(a,b){return this._client.get(cT`/chat/completions/${a}`,b)}update(a,b,c){return this._client.post(cT`/chat/completions/${a}`,{body:b,...c})}list(a={},b){return this._client.getAPIList("/chat/completions",cA,{query:a,...b})}delete(a,b){return this._client.delete(cT`/chat/completions/${a}`,b)}parse(a,b){for(let b of a.tools??[]){if("function"!==b.type)throw new bD(`Currently only \`function\` tool types support auto-parsing; Received \`${b.type}\``);if(!0!==b.function.strict)throw new bD(`The \`${b.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(a,{...b,headers:{...b?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(b=>cY(b,a))}runTools(a,b){return a.stream?dc.runTools(this._client,a,b):c3.runTools(this._client,a,b)}stream(a,b){return c8.createChatCompletion(this._client,a,b)}}dd.Messages=cU;class de extends cQ{constructor(){super(...arguments),this.completions=new dd(this._client)}}de.Completions=dd,a.s([],93582);let df=Symbol("brand.privateNullableHeaders"),dg=a=>{let b=new Headers,c=new Set;for(let d of a){let a=new Set;for(let[e,f]of function*(a){let b;if(!a)return;if(df in a){let{values:b,nulls:c}=a;for(let a of(yield*b.entries(),c))yield[a,null];return}let c=!1;for(let d of(a instanceof Headers?b=a.entries():bV(a)?b=a:(c=!0,b=Object.entries(a??{})),b)){let a=d[0];if("string"!=typeof a)throw TypeError("expected header name to be a string");let b=bV(d[1])?d[1]:[d[1]],e=!1;for(let d of b)void 0!==d&&(c&&!e&&(e=!0,yield[a,null]),yield[a,d])}}(d)){let d=e.toLowerCase();a.has(d)||(b.delete(e),a.add(d)),null===f?(b.delete(e),c.add(d)):(b.append(e,f),c.delete(d))}}return{[df]:!0,values:b,nulls:c}};class dh extends cQ{create(a,b){return this._client.post("/audio/speech",{body:a,...b,headers:dg([{Accept:"application/octet-stream"},b?.headers]),__binaryResponse:!0})}}class di extends cQ{create(a,b){return this._client.post("/audio/transcriptions",cH({body:a,...b,stream:a.stream??!1,__metadata:{model:a.model}},this._client))}}class dj extends cQ{create(a,b){return this._client.post("/audio/translations",cH({body:a,...b,__metadata:{model:a.model}},this._client))}}class dk extends cQ{constructor(){super(...arguments),this.transcriptions=new di(this._client),this.translations=new dj(this._client),this.speech=new dh(this._client)}}dk.Transcriptions=di,dk.Translations=dj,dk.Speech=dh;class dl extends cQ{create(a,b){return this._client.post("/batches",{body:a,...b})}retrieve(a,b){return this._client.get(cT`/batches/${a}`,b)}list(a={},b){return this._client.getAPIList("/batches",cA,{query:a,...b})}cancel(a,b){return this._client.post(cT`/batches/${a}/cancel`,b)}}class dm extends cQ{create(a,b){return this._client.post("/assistants",{body:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}retrieve(a,b){return this._client.get(cT`/assistants/${a}`,{...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}update(a,b,c){return this._client.post(cT`/assistants/${a}`,{body:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a={},b){return this._client.getAPIList("/assistants",cA,{query:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}delete(a,b){return this._client.delete(cT`/assistants/${a}`,{...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}}class dn extends cQ{create(a,b){return this._client.post("/realtime/sessions",{body:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}}class dp extends cQ{create(a,b){return this._client.post("/realtime/transcription_sessions",{body:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}}class dq extends cQ{constructor(){super(...arguments),this.sessions=new dn(this._client),this.transcriptionSessions=new dp(this._client)}}dq.Sessions=dn,dq.TranscriptionSessions=dp;class dr extends cQ{create(a,b){return this._client.post("/chatkit/sessions",{body:a,...b,headers:dg([{"OpenAI-Beta":"chatkit_beta=v1"},b?.headers])})}cancel(a,b){return this._client.post(cT`/chatkit/sessions/${a}/cancel`,{...b,headers:dg([{"OpenAI-Beta":"chatkit_beta=v1"},b?.headers])})}}class ds extends cQ{retrieve(a,b){return this._client.get(cT`/chatkit/threads/${a}`,{...b,headers:dg([{"OpenAI-Beta":"chatkit_beta=v1"},b?.headers])})}list(a={},b){return this._client.getAPIList("/chatkit/threads",cB,{query:a,...b,headers:dg([{"OpenAI-Beta":"chatkit_beta=v1"},b?.headers])})}delete(a,b){return this._client.delete(cT`/chatkit/threads/${a}`,{...b,headers:dg([{"OpenAI-Beta":"chatkit_beta=v1"},b?.headers])})}listItems(a,b={},c){return this._client.getAPIList(cT`/chatkit/threads/${a}/items`,cB,{query:b,...c,headers:dg([{"OpenAI-Beta":"chatkit_beta=v1"},c?.headers])})}}class dt extends cQ{constructor(){super(...arguments),this.sessions=new dr(this._client),this.threads=new ds(this._client)}}dt.Sessions=dr,dt.Threads=ds;class du extends cQ{create(a,b,c){return this._client.post(cT`/threads/${a}/messages`,{body:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}retrieve(a,b,c){let{thread_id:d}=b;return this._client.get(cT`/threads/${d}/messages/${a}`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}update(a,b,c){let{thread_id:d,...e}=b;return this._client.post(cT`/threads/${d}/messages/${a}`,{body:e,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b={},c){return this._client.getAPIList(cT`/threads/${a}/messages`,cA,{query:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}delete(a,b,c){let{thread_id:d}=b;return this._client.delete(cT`/threads/${d}/messages/${a}`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}class dv extends cQ{retrieve(a,b,c){let{thread_id:d,run_id:e,...f}=b;return this._client.get(cT`/threads/${d}/runs/${e}/steps/${a}`,{query:f,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b,c){let{thread_id:d,...e}=b;return this._client.getAPIList(cT`/threads/${d}/runs/${a}/steps`,cA,{query:e,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}let dw=a=>void 0!==globalThis.process?globalThis.process.env?.[a]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(a)?.trim():void 0;class dx extends c1{constructor(){super(...arguments),an.add(this),ap.set(this,[]),aq.set(this,{}),ar.set(this,{}),as.set(this,void 0),at.set(this,void 0),au.set(this,void 0),av.set(this,void 0),aw.set(this,void 0),ax.set(this,void 0),ay.set(this,void 0),az.set(this,void 0),aA.set(this,void 0)}[(ap=new WeakMap,aq=new WeakMap,ar=new WeakMap,as=new WeakMap,at=new WeakMap,au=new WeakMap,av=new WeakMap,aw=new WeakMap,ax=new WeakMap,ay=new WeakMap,az=new WeakMap,aA=new WeakMap,an=new WeakSet,Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(a){let b=new ao;return b._run(()=>b._fromReadableStream(a)),b}async _fromReadableStream(a,b){let c=b?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),this._connected();let d=cq.fromReadableStream(a,this.controller);for await(let a of d)bz(this,an,"m",aB).call(this,a);if(d.controller.signal?.aborted)throw new bF;return this._addRun(bz(this,an,"m",aC).call(this))}toReadableStream(){return new cq(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(a,b,c,d){let e=new ao;return e._run(()=>e._runToolAssistantStream(a,b,c,{...d,headers:{...d?.headers,"X-Stainless-Helper-Method":"stream"}})),e}async _createToolAssistantStream(a,b,c,d){let e=d?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort()));let f={...c,stream:!0},g=await a.submitToolOutputs(b,f,{...d,signal:this.controller.signal});for await(let a of(this._connected(),g))bz(this,an,"m",aB).call(this,a);if(g.controller.signal?.aborted)throw new bF;return this._addRun(bz(this,an,"m",aC).call(this))}static createThreadAssistantStream(a,b,c){let d=new ao;return d._run(()=>d._threadAssistantStream(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}static createAssistantStream(a,b,c,d){let e=new ao;return e._run(()=>e._runAssistantStream(a,b,c,{...d,headers:{...d?.headers,"X-Stainless-Helper-Method":"stream"}})),e}currentEvent(){return bz(this,ay,"f")}currentRun(){return bz(this,az,"f")}currentMessageSnapshot(){return bz(this,as,"f")}currentRunStepSnapshot(){return bz(this,aA,"f")}async finalRunSteps(){return await this.done(),Object.values(bz(this,aq,"f"))}async finalMessages(){return await this.done(),Object.values(bz(this,ar,"f"))}async finalRun(){if(await this.done(),!bz(this,at,"f"))throw Error("Final run was not received.");return bz(this,at,"f")}async _createThreadAssistantStream(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort()));let e={...b,stream:!0},f=await a.createAndRun(e,{...c,signal:this.controller.signal});for await(let a of(this._connected(),f))bz(this,an,"m",aB).call(this,a);if(f.controller.signal?.aborted)throw new bF;return this._addRun(bz(this,an,"m",aC).call(this))}async _createAssistantStream(a,b,c,d){let e=d?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort()));let f={...c,stream:!0},g=await a.create(b,f,{...d,signal:this.controller.signal});for await(let a of(this._connected(),g))bz(this,an,"m",aB).call(this,a);if(g.controller.signal?.aborted)throw new bF;return this._addRun(bz(this,an,"m",aC).call(this))}static accumulateDelta(a,b){for(let[c,d]of Object.entries(b)){if(!a.hasOwnProperty(c)){a[c]=d;continue}let b=a[c];if(null==b||"index"===c||"type"===c){a[c]=d;continue}if("string"==typeof b&&"string"==typeof d)b+=d;else if("number"==typeof b&&"number"==typeof d)b+=d;else if(bX(b)&&bX(d))b=this.accumulateDelta(b,d);else if(Array.isArray(b)&&Array.isArray(d)){if(b.every(a=>"string"==typeof a||"number"==typeof a)){b.push(...d);continue}for(let a of d){if(!bX(a))throw Error(`Expected array delta entry to be an object but got: ${a}`);let c=a.index;if(null==c)throw console.error(a),Error("Expected array delta entry to have an `index` property");if("number"!=typeof c)throw Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);let d=b[c];null==d?b.push(a):b[c]=this.accumulateDelta(d,a)}continue}else throw Error(`Unhandled record type: ${c}, deltaValue: ${d}, accValue: ${b}`);a[c]=b}return a}_addRun(a){return a}async _threadAssistantStream(a,b,c){return await this._createThreadAssistantStream(b,a,c)}async _runAssistantStream(a,b,c,d){return await this._createAssistantStream(b,a,c,d)}async _runToolAssistantStream(a,b,c,d){return await this._createToolAssistantStream(b,a,c,d)}}ao=dx,aB=function(a){if(!this.ended)switch(by(this,ay,a,"f"),bz(this,an,"m",aF).call(this,a),a.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":bz(this,an,"m",aJ).call(this,a);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":bz(this,an,"m",aE).call(this,a);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":bz(this,an,"m",aD).call(this,a);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},aC=function(){if(this.ended)throw new bD("stream has ended, this shouldn't happen");if(!bz(this,at,"f"))throw Error("Final run has not been received");return bz(this,at,"f")},aD=function(a){let[b,c]=bz(this,an,"m",aH).call(this,a,bz(this,as,"f"));for(let a of(by(this,as,b,"f"),bz(this,ar,"f")[b.id]=b,c)){let c=b.content[a.index];c?.type=="text"&&this._emit("textCreated",c.text)}switch(a.event){case"thread.message.created":this._emit("messageCreated",a.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",a.data.delta,b),a.data.delta.content)for(let c of a.data.delta.content){if("text"==c.type&&c.text){let a=c.text,d=b.content[c.index];if(d&&"text"==d.type)this._emit("textDelta",a,d.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(c.index!=bz(this,au,"f")){if(bz(this,av,"f"))switch(bz(this,av,"f").type){case"text":this._emit("textDone",bz(this,av,"f").text,bz(this,as,"f"));break;case"image_file":this._emit("imageFileDone",bz(this,av,"f").image_file,bz(this,as,"f"))}by(this,au,c.index,"f")}by(this,av,b.content[c.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==bz(this,au,"f")){let b=a.data.content[bz(this,au,"f")];if(b)switch(b.type){case"image_file":this._emit("imageFileDone",b.image_file,bz(this,as,"f"));break;case"text":this._emit("textDone",b.text,bz(this,as,"f"))}}bz(this,as,"f")&&this._emit("messageDone",a.data),by(this,as,void 0,"f")}},aE=function(a){let b=bz(this,an,"m",aG).call(this,a);switch(by(this,aA,b,"f"),a.event){case"thread.run.step.created":this._emit("runStepCreated",a.data);break;case"thread.run.step.delta":let c=a.data.delta;if(c.step_details&&"tool_calls"==c.step_details.type&&c.step_details.tool_calls&&"tool_calls"==b.step_details.type)for(let a of c.step_details.tool_calls)a.index==bz(this,aw,"f")?this._emit("toolCallDelta",a,b.step_details.tool_calls[a.index]):(bz(this,ax,"f")&&this._emit("toolCallDone",bz(this,ax,"f")),by(this,aw,a.index,"f"),by(this,ax,b.step_details.tool_calls[a.index],"f"),bz(this,ax,"f")&&this._emit("toolCallCreated",bz(this,ax,"f")));this._emit("runStepDelta",a.data.delta,b);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":by(this,aA,void 0,"f"),"tool_calls"==a.data.step_details.type&&bz(this,ax,"f")&&(this._emit("toolCallDone",bz(this,ax,"f")),by(this,ax,void 0,"f")),this._emit("runStepDone",a.data,b)}},aF=function(a){bz(this,ap,"f").push(a),this._emit("event",a)},aG=function(a){switch(a.event){case"thread.run.step.created":return bz(this,aq,"f")[a.data.id]=a.data,a.data;case"thread.run.step.delta":let b=bz(this,aq,"f")[a.data.id];if(!b)throw Error("Received a RunStepDelta before creation of a snapshot");let c=a.data;if(c.delta){let d=ao.accumulateDelta(b,c.delta);bz(this,aq,"f")[a.data.id]=d}return bz(this,aq,"f")[a.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":bz(this,aq,"f")[a.data.id]=a.data}if(bz(this,aq,"f")[a.data.id])return bz(this,aq,"f")[a.data.id];throw Error("No snapshot available")},aH=function(a,b){let c=[];switch(a.event){case"thread.message.created":return[a.data,c];case"thread.message.delta":if(!b)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let d=a.data;if(d.delta.content)for(let a of d.delta.content)if(a.index in b.content){let c=b.content[a.index];b.content[a.index]=bz(this,an,"m",aI).call(this,a,c)}else b.content[a.index]=a,c.push(a);return[b,c];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(b)return[b,c];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},aI=function(a,b){return ao.accumulateDelta(b,a)},aJ=function(a){switch(by(this,az,a.data,"f"),a.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":by(this,at,a.data,"f"),bz(this,ax,"f")&&(this._emit("toolCallDone",bz(this,ax,"f")),by(this,ax,void 0,"f"))}};class dy extends cQ{constructor(){super(...arguments),this.steps=new dv(this._client)}create(a,b,c){let{include:d,...e}=b;return this._client.post(cT`/threads/${a}/runs`,{query:{include:d},body:e,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers]),stream:b.stream??!1})}retrieve(a,b,c){let{thread_id:d}=b;return this._client.get(cT`/threads/${d}/runs/${a}`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}update(a,b,c){let{thread_id:d,...e}=b;return this._client.post(cT`/threads/${d}/runs/${a}`,{body:e,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b={},c){return this._client.getAPIList(cT`/threads/${a}/runs`,cA,{query:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}cancel(a,b,c){let{thread_id:d}=b;return this._client.post(cT`/threads/${d}/runs/${a}/cancel`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(d.id,{thread_id:a},c)}createAndStream(a,b,c){return dx.createAssistantStream(a,this._client.beta.threads.runs,b,c)}async poll(a,b,c){let d=dg([c?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":c?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:e,response:f}=await this.retrieve(a,b,{...c,headers:{...c?.headers,...d}}).withResponse();switch(e.status){case"queued":case"in_progress":case"cancelling":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await bY(g);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return e}}}stream(a,b,c){return dx.createAssistantStream(a,this._client.beta.threads.runs,b,c)}submitToolOutputs(a,b,c){let{thread_id:d,...e}=b;return this._client.post(cT`/threads/${d}/runs/${a}/submit_tool_outputs`,{body:e,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers]),stream:b.stream??!1})}async submitToolOutputsAndPoll(a,b,c){let d=await this.submitToolOutputs(a,b,c);return await this.poll(d.id,b,c)}submitToolOutputsStream(a,b,c){return dx.createToolAssistantStream(a,this._client.beta.threads.runs,b,c)}}dy.Steps=dv;class dz extends cQ{constructor(){super(...arguments),this.runs=new dy(this._client),this.messages=new du(this._client)}create(a={},b){return this._client.post("/threads",{body:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}retrieve(a,b){return this._client.get(cT`/threads/${a}`,{...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}update(a,b,c){return this._client.post(cT`/threads/${a}`,{body:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}delete(a,b){return this._client.delete(cT`/threads/${a}`,{...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}createAndRun(a,b){return this._client.post("/threads/runs",{body:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers]),stream:a.stream??!1})}async createAndRunPoll(a,b){let c=await this.createAndRun(a,b);return await this.runs.poll(c.id,{thread_id:c.thread_id},b)}createAndRunStream(a,b){return dx.createThreadAssistantStream(a,this._client.beta.threads,b)}}dz.Runs=dy,dz.Messages=du;class dA extends cQ{constructor(){super(...arguments),this.realtime=new dq(this._client),this.chatkit=new dt(this._client),this.assistants=new dm(this._client),this.threads=new dz(this._client)}}dA.Realtime=dq,dA.ChatKit=dt,dA.Assistants=dm,dA.Threads=dz;class dB extends cQ{create(a,b){return this._client.post("/completions",{body:a,...b,stream:a.stream??!1})}}class dC extends cQ{retrieve(a,b,c){let{container_id:d}=b;return this._client.get(cT`/containers/${d}/files/${a}/content`,{...c,headers:dg([{Accept:"application/binary"},c?.headers]),__binaryResponse:!0})}}class dD extends cQ{constructor(){super(...arguments),this.content=new dC(this._client)}create(a,b,c){return this._client.post(cT`/containers/${a}/files`,cH({body:b,...c},this._client))}retrieve(a,b,c){let{container_id:d}=b;return this._client.get(cT`/containers/${d}/files/${a}`,c)}list(a,b={},c){return this._client.getAPIList(cT`/containers/${a}/files`,cA,{query:b,...c})}delete(a,b,c){let{container_id:d}=b;return this._client.delete(cT`/containers/${d}/files/${a}`,{...c,headers:dg([{Accept:"*/*"},c?.headers])})}}dD.Content=dC;class dE extends cQ{constructor(){super(...arguments),this.files=new dD(this._client)}create(a,b){return this._client.post("/containers",{body:a,...b})}retrieve(a,b){return this._client.get(cT`/containers/${a}`,b)}list(a={},b){return this._client.getAPIList("/containers",cA,{query:a,...b})}delete(a,b){return this._client.delete(cT`/containers/${a}`,{...b,headers:dg([{Accept:"*/*"},b?.headers])})}}dE.Files=dD;class dF extends cQ{create(a,b,c){let{include:d,...e}=b;return this._client.post(cT`/conversations/${a}/items`,{query:{include:d},body:e,...c})}retrieve(a,b,c){let{conversation_id:d,...e}=b;return this._client.get(cT`/conversations/${d}/items/${a}`,{query:e,...c})}list(a,b={},c){return this._client.getAPIList(cT`/conversations/${a}/items`,cB,{query:b,...c})}delete(a,b,c){let{conversation_id:d}=b;return this._client.delete(cT`/conversations/${d}/items/${a}`,c)}}class dG extends cQ{constructor(){super(...arguments),this.items=new dF(this._client)}create(a={},b){return this._client.post("/conversations",{body:a,...b})}retrieve(a,b){return this._client.get(cT`/conversations/${a}`,b)}update(a,b,c){return this._client.post(cT`/conversations/${a}`,{body:b,...c})}delete(a,b){return this._client.delete(cT`/conversations/${a}`,b)}}dG.Items=dF;class dH extends cQ{create(a,b){let c=!!a.encoding_format,d=c?a.encoding_format:"base64";c&&co(this._client).debug("embeddings/user defined encoding_format:",a.encoding_format);let e=this._client.post("/embeddings",{body:{...a,encoding_format:d},...b});return c?e:(co(this._client).debug("embeddings/decoding base64 embeddings from base64"),e._thenUnwrap(a=>(a&&a.data&&a.data.forEach(a=>{let b=a.embedding;a.embedding=(a=>{if("undefined"!=typeof Buffer){let b=Buffer.from(a,"base64");return Array.from(new Float32Array(b.buffer,b.byteOffset,b.length/Float32Array.BYTES_PER_ELEMENT))}{let b=atob(a),c=b.length,d=new Uint8Array(c);for(let a=0;a<c;a++)d[a]=b.charCodeAt(a);return Array.from(new Float32Array(d.buffer))}})(b)}),a)))}}class dI extends cQ{retrieve(a,b,c){let{eval_id:d,run_id:e}=b;return this._client.get(cT`/evals/${d}/runs/${e}/output_items/${a}`,c)}list(a,b,c){let{eval_id:d,...e}=b;return this._client.getAPIList(cT`/evals/${d}/runs/${a}/output_items`,cA,{query:e,...c})}}class dJ extends cQ{constructor(){super(...arguments),this.outputItems=new dI(this._client)}create(a,b,c){return this._client.post(cT`/evals/${a}/runs`,{body:b,...c})}retrieve(a,b,c){let{eval_id:d}=b;return this._client.get(cT`/evals/${d}/runs/${a}`,c)}list(a,b={},c){return this._client.getAPIList(cT`/evals/${a}/runs`,cA,{query:b,...c})}delete(a,b,c){let{eval_id:d}=b;return this._client.delete(cT`/evals/${d}/runs/${a}`,c)}cancel(a,b,c){let{eval_id:d}=b;return this._client.post(cT`/evals/${d}/runs/${a}`,c)}}dJ.OutputItems=dI;class dK extends cQ{constructor(){super(...arguments),this.runs=new dJ(this._client)}create(a,b){return this._client.post("/evals",{body:a,...b})}retrieve(a,b){return this._client.get(cT`/evals/${a}`,b)}update(a,b,c){return this._client.post(cT`/evals/${a}`,{body:b,...c})}list(a={},b){return this._client.getAPIList("/evals",cA,{query:a,...b})}delete(a,b){return this._client.delete(cT`/evals/${a}`,b)}}dK.Runs=dJ;class dL extends cQ{create(a,b){return this._client.post("/files",cH({body:a,...b},this._client))}retrieve(a,b){return this._client.get(cT`/files/${a}`,b)}list(a={},b){return this._client.getAPIList("/files",cA,{query:a,...b})}delete(a,b){return this._client.delete(cT`/files/${a}`,b)}content(a,b){return this._client.get(cT`/files/${a}/content`,{...b,headers:dg([{Accept:"application/binary"},b?.headers]),__binaryResponse:!0})}async waitForProcessing(a,{pollInterval:b=5e3,maxWait:c=18e5}={}){let d=new Set(["processed","error","deleted"]),e=Date.now(),f=await this.retrieve(a);for(;!f.status||!d.has(f.status);)if(await bY(b),f=await this.retrieve(a),Date.now()-e>c)throw new bH({message:`Giving up on waiting for file ${a} to finish processing after ${c} milliseconds.`});return f}}class dM extends cQ{}class dN extends cQ{run(a,b){return this._client.post("/fine_tuning/alpha/graders/run",{body:a,...b})}validate(a,b){return this._client.post("/fine_tuning/alpha/graders/validate",{body:a,...b})}}class dO extends cQ{constructor(){super(...arguments),this.graders=new dN(this._client)}}dO.Graders=dN;class dP extends cQ{create(a,b,c){return this._client.getAPIList(cT`/fine_tuning/checkpoints/${a}/permissions`,cz,{body:b,method:"post",...c})}retrieve(a,b={},c){return this._client.get(cT`/fine_tuning/checkpoints/${a}/permissions`,{query:b,...c})}delete(a,b,c){let{fine_tuned_model_checkpoint:d}=b;return this._client.delete(cT`/fine_tuning/checkpoints/${d}/permissions/${a}`,c)}}class dQ extends cQ{constructor(){super(...arguments),this.permissions=new dP(this._client)}}dQ.Permissions=dP;class dR extends cQ{list(a,b={},c){return this._client.getAPIList(cT`/fine_tuning/jobs/${a}/checkpoints`,cA,{query:b,...c})}}class dS extends cQ{constructor(){super(...arguments),this.checkpoints=new dR(this._client)}create(a,b){return this._client.post("/fine_tuning/jobs",{body:a,...b})}retrieve(a,b){return this._client.get(cT`/fine_tuning/jobs/${a}`,b)}list(a={},b){return this._client.getAPIList("/fine_tuning/jobs",cA,{query:a,...b})}cancel(a,b){return this._client.post(cT`/fine_tuning/jobs/${a}/cancel`,b)}listEvents(a,b={},c){return this._client.getAPIList(cT`/fine_tuning/jobs/${a}/events`,cA,{query:b,...c})}pause(a,b){return this._client.post(cT`/fine_tuning/jobs/${a}/pause`,b)}resume(a,b){return this._client.post(cT`/fine_tuning/jobs/${a}/resume`,b)}}dS.Checkpoints=dR;class dT extends cQ{constructor(){super(...arguments),this.methods=new dM(this._client),this.jobs=new dS(this._client),this.checkpoints=new dQ(this._client),this.alpha=new dO(this._client)}}dT.Methods=dM,dT.Jobs=dS,dT.Checkpoints=dQ,dT.Alpha=dO;class dU extends cQ{}class dV extends cQ{constructor(){super(...arguments),this.graderModels=new dU(this._client)}}dV.GraderModels=dU;class dW extends cQ{createVariation(a,b){return this._client.post("/images/variations",cH({body:a,...b},this._client))}edit(a,b){return this._client.post("/images/edits",cH({body:a,...b,stream:a.stream??!1},this._client))}generate(a,b){return this._client.post("/images/generations",{body:a,...b,stream:a.stream??!1})}}class dX extends cQ{retrieve(a,b){return this._client.get(cT`/models/${a}`,b)}list(a){return this._client.getAPIList("/models",cz,a)}delete(a,b){return this._client.delete(cT`/models/${a}`,b)}}class dY extends cQ{create(a,b){return this._client.post("/moderations",{body:a,...b})}}class dZ extends cQ{accept(a,b,c){return this._client.post(cT`/realtime/calls/${a}/accept`,{body:b,...c,headers:dg([{Accept:"*/*"},c?.headers])})}hangup(a,b){return this._client.post(cT`/realtime/calls/${a}/hangup`,{...b,headers:dg([{Accept:"*/*"},b?.headers])})}refer(a,b,c){return this._client.post(cT`/realtime/calls/${a}/refer`,{body:b,...c,headers:dg([{Accept:"*/*"},c?.headers])})}reject(a,b={},c){return this._client.post(cT`/realtime/calls/${a}/reject`,{body:b,...c,headers:dg([{Accept:"*/*"},c?.headers])})}}class d$ extends cQ{create(a,b){return this._client.post("/realtime/client_secrets",{body:a,...b})}}class d_ extends cQ{constructor(){super(...arguments),this.clientSecrets=new d$(this._client),this.calls=new dZ(this._client)}}function d0(a,b){let c=a.output.map(a=>{if("function_call"===a.type)return{...a,parsed_arguments:function(a,b){var c,d;let e=(c=a.tools??[],d=b.name,c.find(a=>"function"===a.type&&a.name===d));return{...b,...b,parsed_arguments:e?.$brand==="auto-parseable-tool"?e.$parseRaw(b.arguments):e?.strict?JSON.parse(b.arguments):null}}(b,a)};if("message"===a.type){let c=a.content.map(a=>{var c,d;return"output_text"===a.type?{...a,parsed:(c=b,d=a.text,c.text?.format?.type!=="json_schema"?null:"$parseRaw"in c.text?.format?(c.text?.format).$parseRaw(d):JSON.parse(d))}:a});return{...a,content:c}}return a}),d=Object.assign({},a,{output:c});return Object.getOwnPropertyDescriptor(a,"output_text")||d1(d),Object.defineProperty(d,"output_parsed",{enumerable:!0,get(){for(let a of d.output)if("message"===a.type){for(let b of a.content)if("output_text"===b.type&&null!==b.parsed)return b.parsed}return null}}),d}function d1(a){let b=[];for(let c of a.output)if("message"===c.type)for(let a of c.content)"output_text"===a.type&&b.push(a.text);a.output_text=b.join("")}d_.ClientSecrets=d$,d_.Calls=dZ;class d2 extends c1{constructor(a){super(),aK.add(this),aL.set(this,void 0),aM.set(this,void 0),aN.set(this,void 0),by(this,aL,a,"f")}static createResponse(a,b,c){let d=new d2(b);return d._run(()=>d._createOrRetrieveResponse(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createOrRetrieveResponse(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort())),bz(this,aK,"m",aO).call(this);let f=null;for await(let e of("response_id"in b?(d=await a.responses.retrieve(b.response_id,{stream:!0},{...c,signal:this.controller.signal,stream:!0}),f=b.starting_after??null):d=await a.responses.create({...b,stream:!0},{...c,signal:this.controller.signal}),this._connected(),d))bz(this,aK,"m",aP).call(this,e,f);if(d.controller.signal?.aborted)throw new bF;return bz(this,aK,"m",aQ).call(this)}[(aL=new WeakMap,aM=new WeakMap,aN=new WeakMap,aK=new WeakSet,aO=function(){this.ended||by(this,aM,void 0,"f")},aP=function(a,b){if(this.ended)return;let c=(a,c)=>{(null==b||c.sequence_number>b)&&this._emit(a,c)},d=bz(this,aK,"m",aR).call(this,a);switch(c("event",a),a.type){case"response.output_text.delta":{let b=d.output[a.output_index];if(!b)throw new bD(`missing output at index ${a.output_index}`);if("message"===b.type){let d=b.content[a.content_index];if(!d)throw new bD(`missing content at index ${a.content_index}`);if("output_text"!==d.type)throw new bD(`expected content to be 'output_text', got ${d.type}`);c("response.output_text.delta",{...a,snapshot:d.text})}break}case"response.function_call_arguments.delta":{let b=d.output[a.output_index];if(!b)throw new bD(`missing output at index ${a.output_index}`);"function_call"===b.type&&c("response.function_call_arguments.delta",{...a,snapshot:b.arguments});break}default:c(a.type,a)}},aQ=function(){if(this.ended)throw new bD("stream has ended, this shouldn't happen");let a=bz(this,aM,"f");if(!a)throw new bD("request ended without sending any events");by(this,aM,void 0,"f");let b=function(a,b){var c;return b&&(c=b,cW(c.text?.format))?d0(a,b):{...a,output_parsed:null,output:a.output.map(a=>"function_call"===a.type?{...a,parsed_arguments:null}:"message"===a.type?{...a,content:a.content.map(a=>({...a,parsed:null}))}:a)}}(a,bz(this,aL,"f"));return by(this,aN,b,"f"),b},aR=function(a){let b=bz(this,aM,"f");if(!b){if("response.created"!==a.type)throw new bD(`When snapshot hasn't been set yet, expected 'response.created' event, got ${a.type}`);return by(this,aM,a.response,"f")}switch(a.type){case"response.output_item.added":b.output.push(a.item);break;case"response.content_part.added":{let c=b.output[a.output_index];if(!c)throw new bD(`missing output at index ${a.output_index}`);let d=c.type,e=a.part;"message"===d&&"reasoning_text"!==e.type?c.content.push(e):"reasoning"===d&&"reasoning_text"===e.type&&(c.content||(c.content=[]),c.content.push(e));break}case"response.output_text.delta":{let c=b.output[a.output_index];if(!c)throw new bD(`missing output at index ${a.output_index}`);if("message"===c.type){let b=c.content[a.content_index];if(!b)throw new bD(`missing content at index ${a.content_index}`);if("output_text"!==b.type)throw new bD(`expected content to be 'output_text', got ${b.type}`);b.text+=a.delta}break}case"response.function_call_arguments.delta":{let c=b.output[a.output_index];if(!c)throw new bD(`missing output at index ${a.output_index}`);"function_call"===c.type&&(c.arguments+=a.delta);break}case"response.reasoning_text.delta":{let c=b.output[a.output_index];if(!c)throw new bD(`missing output at index ${a.output_index}`);if("reasoning"===c.type){let b=c.content?.[a.content_index];if(!b)throw new bD(`missing content at index ${a.content_index}`);if("reasoning_text"!==b.type)throw new bD(`expected content to be 'reasoning_text', got ${b.type}`);b.text+=a.delta}break}case"response.completed":by(this,aM,a.response,"f")}return b},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let a=bz(this,aN,"f");if(!a)throw new bD("stream ended without producing a ChatCompletion");return a}}class d3 extends cQ{list(a,b={},c){return this._client.getAPIList(cT`/responses/${a}/input_items`,cA,{query:b,...c})}}class d4 extends cQ{count(a={},b){return this._client.post("/responses/input_tokens",{body:a,...b})}}class d5 extends cQ{constructor(){super(...arguments),this.inputItems=new d3(this._client),this.inputTokens=new d4(this._client)}create(a,b){return this._client.post("/responses",{body:a,...b,stream:a.stream??!1})._thenUnwrap(a=>("object"in a&&"response"===a.object&&d1(a),a))}retrieve(a,b={},c){return this._client.get(cT`/responses/${a}`,{query:b,...c,stream:b?.stream??!1})._thenUnwrap(a=>("object"in a&&"response"===a.object&&d1(a),a))}delete(a,b){return this._client.delete(cT`/responses/${a}`,{...b,headers:dg([{Accept:"*/*"},b?.headers])})}parse(a,b){return this._client.responses.create(a,b)._thenUnwrap(b=>d0(b,a))}stream(a,b){return d2.createResponse(this._client,a,b)}cancel(a,b){return this._client.post(cT`/responses/${a}/cancel`,b)}compact(a,b){return this._client.post("/responses/compact",{body:a,...b})}}d5.InputItems=d3,d5.InputTokens=d4;class d6 extends cQ{create(a,b,c){return this._client.post(cT`/uploads/${a}/parts`,cH({body:b,...c},this._client))}}class d7 extends cQ{constructor(){super(...arguments),this.parts=new d6(this._client)}create(a,b){return this._client.post("/uploads",{body:a,...b})}cancel(a,b){return this._client.post(cT`/uploads/${a}/cancel`,b)}complete(a,b,c){return this._client.post(cT`/uploads/${a}/complete`,{body:b,...c})}}d7.Parts=d6;let d8=async a=>{let b=await Promise.allSettled(a),c=b.filter(a=>"rejected"===a.status);if(c.length){for(let a of c)console.error(a.reason);throw Error(`${c.length} promise(s) failed - see the above errors`)}let d=[];for(let a of b)"fulfilled"===a.status&&d.push(a.value);return d};class d9 extends cQ{create(a,b,c){return this._client.post(cT`/vector_stores/${a}/file_batches`,{body:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}retrieve(a,b,c){let{vector_store_id:d}=b;return this._client.get(cT`/vector_stores/${d}/file_batches/${a}`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}cancel(a,b,c){let{vector_store_id:d}=b;return this._client.post(cT`/vector_stores/${d}/file_batches/${a}/cancel`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async createAndPoll(a,b,c){let d=await this.create(a,b);return await this.poll(a,d.id,c)}listFiles(a,b,c){let{vector_store_id:d,...e}=b;return this._client.getAPIList(cT`/vector_stores/${d}/file_batches/${a}/files`,cA,{query:e,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async poll(a,b,c){let d=dg([c?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":c?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:e,response:f}=await this.retrieve(b,{vector_store_id:a},{...c,headers:d}).withResponse();switch(e.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await bY(g);break;case"failed":case"cancelled":case"completed":return e}}}async uploadAndPoll(a,{files:b,fileIds:c=[]},d){if(null==b||0==b.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let e=Math.min(d?.maxConcurrency??5,b.length),f=this._client,g=b.values(),h=[...c];async function i(a){for(let b of a){let a=await f.files.create({file:b,purpose:"assistants"},d);h.push(a.id)}}let j=Array(e).fill(g).map(i);return await d8(j),await this.createAndPoll(a,{file_ids:h})}}class ea extends cQ{create(a,b,c){return this._client.post(cT`/vector_stores/${a}/files`,{body:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}retrieve(a,b,c){let{vector_store_id:d}=b;return this._client.get(cT`/vector_stores/${d}/files/${a}`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}update(a,b,c){let{vector_store_id:d,...e}=b;return this._client.post(cT`/vector_stores/${d}/files/${a}`,{body:e,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b={},c){return this._client.getAPIList(cT`/vector_stores/${a}/files`,cA,{query:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}delete(a,b,c){let{vector_store_id:d}=b;return this._client.delete(cT`/vector_stores/${d}/files/${a}`,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(a,d.id,c)}async poll(a,b,c){let d=dg([c?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":c?.pollIntervalMs?.toString()??void 0}]);for(;;){let e=await this.retrieve(b,{vector_store_id:a},{...c,headers:d}).withResponse(),f=e.data;switch(f.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=e.response.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await bY(g);break;case"failed":case"completed":return f}}}async upload(a,b,c){let d=await this._client.files.create({file:b,purpose:"assistants"},c);return this.create(a,{file_id:d.id},c)}async uploadAndPoll(a,b,c){let d=await this.upload(a,b,c);return await this.poll(a,d.id,c)}content(a,b,c){let{vector_store_id:d}=b;return this._client.getAPIList(cT`/vector_stores/${d}/files/${a}/content`,cz,{...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}class eb extends cQ{constructor(){super(...arguments),this.files=new ea(this._client),this.fileBatches=new d9(this._client)}create(a,b){return this._client.post("/vector_stores",{body:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}retrieve(a,b){return this._client.get(cT`/vector_stores/${a}`,{...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}update(a,b,c){return this._client.post(cT`/vector_stores/${a}`,{body:b,...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a={},b){return this._client.getAPIList("/vector_stores",cA,{query:a,...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}delete(a,b){return this._client.delete(cT`/vector_stores/${a}`,{...b,headers:dg([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}search(a,b,c){return this._client.getAPIList(cT`/vector_stores/${a}/search`,cz,{body:b,method:"post",...c,headers:dg([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}eb.Files=ea,eb.FileBatches=d9;class ec extends cQ{create(a,b){return this._client.post("/videos",cG({body:a,...b},this._client))}retrieve(a,b){return this._client.get(cT`/videos/${a}`,b)}list(a={},b){return this._client.getAPIList("/videos",cB,{query:a,...b})}delete(a,b){return this._client.delete(cT`/videos/${a}`,b)}downloadContent(a,b={},c){return this._client.get(cT`/videos/${a}/content`,{query:b,...c,headers:dg([{Accept:"application/binary"},c?.headers]),__binaryResponse:!0})}remix(a,b,c){return this._client.post(cT`/videos/${a}/remix`,cG({body:b,...c},this._client))}}class ed extends cQ{constructor(){super(...arguments),aS.add(this)}async unwrap(a,b,c=this._client.webhookSecret,d=300){return await this.verifySignature(a,b,c,d),JSON.parse(a)}async verifySignature(a,b,c=this._client.webhookSecret,d=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");bz(this,aS,"m",aT).call(this,c);let e=dg([b]).values,f=bz(this,aS,"m",aU).call(this,e,"webhook-signature"),g=bz(this,aS,"m",aU).call(this,e,"webhook-timestamp"),h=bz(this,aS,"m",aU).call(this,e,"webhook-id"),i=parseInt(g,10);if(isNaN(i))throw new bS("Invalid webhook timestamp format");let j=Math.floor(Date.now()/1e3);if(j-i>d)throw new bS("Webhook timestamp is too old");if(i>j+d)throw new bS("Webhook timestamp is too new");let k=f.split(" ").map(a=>a.startsWith("v1,")?a.substring(3):a),l=c.startsWith("whsec_")?Buffer.from(c.replace("whsec_",""),"base64"):Buffer.from(c,"utf-8"),m=h?`${h}.${g}.${a}`:`${g}.${a}`,n=await crypto.subtle.importKey("raw",l,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let a of k)try{let b=Buffer.from(a,"base64");if(await crypto.subtle.verify("HMAC",n,b,new TextEncoder().encode(m)))return}catch{continue}throw new bS("The given webhook signature does not match the expected signature")}}aS=new WeakSet,aT=function(a){if("string"!=typeof a||0===a.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},aU=function(a,b){if(!a)throw Error("Headers are required");let c=a.get(b);if(null==c)throw Error(`Missing required header: ${b}`);return c},a.i(93582);class ee{constructor({baseURL:a=dw("OPENAI_BASE_URL"),apiKey:b=dw("OPENAI_API_KEY"),organization:c=dw("OPENAI_ORG_ID")??null,project:d=dw("OPENAI_PROJECT_ID")??null,webhookSecret:e=dw("OPENAI_WEBHOOK_SECRET")??null,...f}={}){if(aV.add(this),aX.set(this,void 0),this.completions=new dB(this),this.chat=new de(this),this.embeddings=new dH(this),this.files=new dL(this),this.images=new dW(this),this.audio=new dk(this),this.moderations=new dY(this),this.models=new dX(this),this.fineTuning=new dT(this),this.graders=new dV(this),this.vectorStores=new eb(this),this.webhooks=new ed(this),this.beta=new dA(this),this.batches=new dl(this),this.uploads=new d7(this),this.responses=new d5(this),this.realtime=new d_(this),this.conversations=new dG(this),this.evals=new dK(this),this.containers=new dE(this),this.videos=new ec(this),void 0===b)throw new bD("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const g={apiKey:b,organization:c,project:d,webhookSecret:e,...f,baseURL:a||"https://api.openai.com/v1"};g.dangerouslyAllowBrowser,this.baseURL=g.baseURL,this.timeout=g.timeout??aW.DEFAULT_TIMEOUT,this.logger=g.logger??console;const h="warn";this.logLevel=h,this.logLevel=cj(g.logLevel,"ClientOptions.logLevel",this)??cj(dw("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??h,this.fetchOptions=g.fetchOptions,this.maxRetries=g.maxRetries??2,this.fetch=g.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),by(this,aX,b4,"f"),this._options=g,this.apiKey="string"==typeof b?b:"Missing Key",this.organization=c,this.project=d,this.webhookSecret=e}withOptions(a){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...a})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:a,nulls:b}){}async authHeaders(a){return dg([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(a){return function(a,b={}){let c,d=a,e=function(a=cd){let b;if(void 0!==a.allowEmptyArrays&&"boolean"!=typeof a.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==a.encodeDotInKeys&&"boolean"!=typeof a.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==a.encoder&&void 0!==a.encoder&&"function"!=typeof a.encoder)throw TypeError("Encoder has to be a function.");let c=a.charset||cd.charset;if(void 0!==a.charset&&"utf-8"!==a.charset&&"iso-8859-1"!==a.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let d=b5;if(void 0!==a.format){if(!b8(b7,a.format))throw TypeError("Unknown format option provided.");d=a.format}let e=b7[d],f=cd.filter;if(("function"==typeof a.filter||bU(a.filter))&&(f=a.filter),b=a.arrayFormat&&a.arrayFormat in cb?a.arrayFormat:"indices"in a?a.indices?"indices":"repeat":cd.arrayFormat,"commaRoundTrip"in a&&"boolean"!=typeof a.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let g=void 0===a.allowDots?!0==!!a.encodeDotInKeys||cd.allowDots:!!a.allowDots;return{addQueryPrefix:"boolean"==typeof a.addQueryPrefix?a.addQueryPrefix:cd.addQueryPrefix,allowDots:g,allowEmptyArrays:"boolean"==typeof a.allowEmptyArrays?!!a.allowEmptyArrays:cd.allowEmptyArrays,arrayFormat:b,charset:c,charsetSentinel:"boolean"==typeof a.charsetSentinel?a.charsetSentinel:cd.charsetSentinel,commaRoundTrip:!!a.commaRoundTrip,delimiter:void 0===a.delimiter?cd.delimiter:a.delimiter,encode:"boolean"==typeof a.encode?a.encode:cd.encode,encodeDotInKeys:"boolean"==typeof a.encodeDotInKeys?a.encodeDotInKeys:cd.encodeDotInKeys,encoder:"function"==typeof a.encoder?a.encoder:cd.encoder,encodeValuesOnly:"boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:cd.encodeValuesOnly,filter:f,format:d,formatter:e,serializeDate:"function"==typeof a.serializeDate?a.serializeDate:cd.serializeDate,skipNulls:"boolean"==typeof a.skipNulls?a.skipNulls:cd.skipNulls,sort:"function"==typeof a.sort?a.sort:null,strictNullHandling:"boolean"==typeof a.strictNullHandling?a.strictNullHandling:cd.strictNullHandling}}(b);"function"==typeof e.filter?d=(0,e.filter)("",d):bU(e.filter)&&(c=e.filter);let f=[];if("object"!=typeof d||null===d)return"";let g=cb[e.arrayFormat],h="comma"===g&&e.commaRoundTrip;c||(c=Object.keys(d)),e.sort&&c.sort(e.sort);let i=new WeakMap;for(let a=0;a<c.length;++a){let b=c[a];e.skipNulls&&null===d[b]||cc(f,function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u;let v,w=b,x=s,y=0,z=!1;for(;void 0!==(x=x.get(ce))&&!z;){let a=x.get(b);if(y+=1,void 0!==a)if(a===y)throw RangeError("Cyclic object value");else z=!0;void 0===x.get(ce)&&(y=0)}if("function"==typeof k?w=k(c,w):w instanceof Date?w=n?.(w):"comma"===d&&bU(w)&&(w=ca(w,function(a){return a instanceof Date?n?.(a):a})),null===w){if(g)return j&&!q?j(c,cd.encoder,r,"key",o):c;w=""}if("string"==typeof(t=w)||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t||(u=w)&&"object"==typeof u&&u.constructor&&u.constructor.isBuffer&&u.constructor.isBuffer(u)){if(j){let a=q?c:j(c,cd.encoder,r,"key",o);return[p?.(a)+"="+p?.(j(w,cd.encoder,r,"value",o))]}return[p?.(c)+"="+p?.(String(w))]}let A=[];if(void 0===w)return A;if("comma"===d&&bU(w))q&&j&&(w=ca(w,j)),v=[{value:w.length>0?w.join(",")||null:void 0}];else if(bU(k))v=k;else{let a=Object.keys(w);v=l?a.sort(l):a}let B=i?String(c).replace(/\./g,"%2E"):String(c),C=e&&bU(w)&&1===w.length?B+"[]":B;if(f&&bU(w)&&0===w.length)return C+"[]";for(let c=0;c<v.length;++c){let t=v[c],u="object"==typeof t&&void 0!==t.value?t.value:w[t];if(h&&null===u)continue;let x=m&&i?t.replace(/\./g,"%2E"):t,z=bU(w)?"function"==typeof d?d(C,x):C:C+(m?"."+x:"["+x+"]");s.set(b,y);let B=new WeakMap;B.set(ce,s),cc(A,a(u,z,d,e,f,g,h,i,"comma"===d&&q&&bU(w)?null:j,k,l,m,n,o,p,q,r,B))}return A}(d[b],b,g,h,e.allowEmptyArrays,e.strictNullHandling,e.skipNulls,e.encodeDotInKeys,e.encode?e.encoder:null,e.filter,e.sort,e.allowDots,e.serializeDate,e.format,e.formatter,e.encodeValuesOnly,e.charset,i))}let j=f.join(e.delimiter),k=!0===e.addQueryPrefix?"?":"";return e.charsetSentinel&&("iso-8859-1"===e.charset?k+="utf8=%26%2310003%3B&":k+="utf8=%E2%9C%93&"),j.length>0?k+j:""}(a,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${bZ}`}defaultIdempotencyKey(){return`stainless-node-retry-${bA()}`}makeStatusError(a,b,c,d){return bE.generate(a,b,c,d)}async _callApiKey(){let a,b=this._options.apiKey;if("function"!=typeof b)return!1;try{a=await b()}catch(a){if(a instanceof bD)throw a;throw new bD(`Failed to get token from 'apiKey' function: ${a.message}`,{cause:a})}if("string"!=typeof a||!a)throw new bD(`Expected 'apiKey' function argument to return a string but it returned ${a}`);return this.apiKey=a,!0}buildURL(a,b,c){let d=!bz(this,aV,"m",aY).call(this)&&c||this.baseURL,e=new URL(bT.test(a)?a:d+(d.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),f=this.defaultQuery();return!function(a){if(!a)return!0;for(let b in a)return!1;return!0}(f)&&(b={...f,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(e.search=this.stringifyQuery(b)),e.toString()}async prepareOptions(a){await this._callApiKey()}async prepareRequest(a,{url:b,options:c}){}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(c=>({method:a,path:b,...c})))}request(a,b=null){return new cw(this,this.makeRequest(a,b,void 0))}async makeRequest(a,b,c){let d=await a,e=d.maxRetries??this.maxRetries;null==b&&(b=e),await this.prepareOptions(d);let{req:f,url:g,timeout:h}=await this.buildRequest(d,{retryCount:e-b});await this.prepareRequest(f,{url:g,options:d});let i="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),j=void 0===c?"":`, retryOf: ${c}`,k=Date.now();if(co(this).debug(`[${i}] sending request`,cp({retryOfRequestLogID:c,method:d.method,url:g,options:d,headers:f.headers})),d.signal?.aborted)throw new bF;let l=new AbortController,m=await this.fetchWithTimeout(g,f,h,l).catch(bC),n=Date.now();if(m instanceof globalThis.Error){let a=`retrying, ${b} attempts remaining`;if(d.signal?.aborted)throw new bF;let e=bB(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(b)return co(this).info(`[${i}] connection ${e?"timed out":"failed"} - ${a}`),co(this).debug(`[${i}] connection ${e?"timed out":"failed"} (${a})`,cp({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),this.retryRequest(d,b,c??i);if(co(this).info(`[${i}] connection ${e?"timed out":"failed"} - error; no more retries left`),co(this).debug(`[${i}] connection ${e?"timed out":"failed"} (error; no more retries left)`,cp({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),e)throw new bH;throw new bG({cause:m})}let o=[...m.headers.entries()].filter(([a])=>"x-request-id"===a).map(([a,b])=>", "+a+": "+JSON.stringify(b)).join(""),p=`[${i}${j}${o}] ${f.method} ${g} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${n-k}ms`;if(!m.ok){let a=await this.shouldRetry(m);if(b&&a){let a=`retrying, ${b} attempts remaining`;return await b3(m.body),co(this).info(`${p} - ${a}`),co(this).debug(`[${i}] response error (${a})`,cp({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),this.retryRequest(d,b,c??i,m.headers)}let e=a?"error; no more retries left":"error; not retryable";co(this).info(`${p} - ${e}`);let f=await m.text().catch(a=>bC(a).message),g=(a=>{try{return JSON.parse(a)}catch(a){return}})(f),h=g?void 0:f;throw co(this).debug(`[${i}] response error (${e})`,cp({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,message:h,durationMs:Date.now()-k})),this.makeStatusError(m.status,g,h,m.headers)}return co(this).info(p),co(this).debug(`[${i}] response start`,cp({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),{response:m,options:d,controller:l,requestLogID:i,retryOfRequestLogID:c,startTime:k}}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}requestAPIList(a,b){return new cy(this,this.makeRequest(b,null,void 0),a)}async fetchWithTimeout(a,b,c,d){let{signal:e,method:f,...g}=b||{};e&&e.addEventListener("abort",()=>d.abort());let h=setTimeout(()=>d.abort(),c),i=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||"object"==typeof g.body&&null!==g.body&&Symbol.asyncIterator in g.body,j={signal:d.signal,...i?{duplex:"half"}:{},method:"GET",...g};f&&(j.method=f.toUpperCase());try{return await this.fetch.call(void 0,a,j)}finally{clearTimeout(h)}}async shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c,d){let e,f=d?.get("retry-after-ms");if(f){let a=parseFloat(f);Number.isNaN(a)||(e=a)}let g=d?.get("retry-after");if(g&&!e){let a=parseFloat(g);e=Number.isNaN(a)?Date.parse(g)-Date.now():1e3*a}if(!(e&&0<=e&&e<6e4)){let c=a.maxRetries??this.maxRetries;e=this.calculateDefaultRetryTimeoutMillis(b,c)}return await bY(e),this.makeRequest(a,b-1,c)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}async buildRequest(a,{retryCount:b=0}={}){let c={...a},{method:d,path:e,query:f,defaultBaseURL:g}=c,h=this.buildURL(e,f,g);"timeout"in c&&((a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new bD(`${a} must be an integer`);if(b<0)throw new bD(`${a} must be a positive integer`)})("timeout",c.timeout),c.timeout=c.timeout??this.timeout;let{bodyHeaders:i,body:j}=this.buildBody({options:c}),k=await this.buildHeaders({options:a,method:d,bodyHeaders:i,retryCount:b});return{req:{method:d,headers:k,...c.signal&&{signal:c.signal},...globalThis.ReadableStream&&j instanceof globalThis.ReadableStream&&{duplex:"half"},...j&&{body:j},...this.fetchOptions??{},...c.fetchOptions??{}},url:h,timeout:c.timeout}}async buildHeaders({options:a,method:c,bodyHeaders:d,retryCount:e}){let f={};this.idempotencyHeader&&"get"!==c&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),f[this.idempotencyHeader]=a.idempotencyKey);let g=dg([f,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(e),...a.timeout?{"X-Stainless-Timeout":String(Math.trunc(a.timeout/1e3))}:{},...b??(b=(()=>{let a="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bZ,"X-Stainless-OS":b_(Deno.build.os),"X-Stainless-Arch":b$(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bZ,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bZ,"X-Stainless-OS":b_(globalThis.process.platform??"unknown"),"X-Stainless-Arch":b$(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let b=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return b?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bZ,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${b.browser}`,"X-Stainless-Runtime-Version":b.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bZ,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(a),this._options.defaultHeaders,d,a.headers]);return this.validateHeaders(g),g.values}buildBody({options:{body:a,headers:b}}){if(!a)return{bodyHeaders:void 0,body:void 0};let c=dg([b]);return ArrayBuffer.isView(a)||a instanceof ArrayBuffer||a instanceof DataView||"string"==typeof a&&c.values.has("content-type")||globalThis.Blob&&a instanceof globalThis.Blob||a instanceof FormData||a instanceof URLSearchParams||globalThis.ReadableStream&&a instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:a}:"object"==typeof a&&(Symbol.asyncIterator in a||Symbol.iterator in a&&"next"in a&&"function"==typeof a.next)?{bodyHeaders:void 0,body:b1(a)}:bz(this,aX,"f").call(this,{body:a,headers:c})}}aW=ee,aX=new WeakMap,aV=new WeakSet,aY=function(){return"https://api.openai.com/v1"!==this.baseURL},ee.OpenAI=aW,ee.DEFAULT_TIMEOUT=6e5,ee.OpenAIError=bD,ee.APIError=bE,ee.APIConnectionError=bG,ee.APIConnectionTimeoutError=bH,ee.APIUserAbortError=bF,ee.NotFoundError=bL,ee.ConflictError=bM,ee.RateLimitError=bO,ee.BadRequestError=bI,ee.AuthenticationError=bJ,ee.InternalServerError=bP,ee.PermissionDeniedError=bK,ee.UnprocessableEntityError=bN,ee.InvalidWebhookSignatureError=bS,ee.toFile=cO,ee.Completions=dB,ee.Chat=de,ee.Embeddings=dH,ee.Files=dL,ee.Images=dW,ee.Audio=dk,ee.Moderations=dY,ee.Models=dX,ee.FineTuning=dT,ee.Graders=dV,ee.VectorStores=eb,ee.Webhooks=ed,ee.Beta=dA,ee.Batches=dl,ee.Uploads=d7,ee.Responses=d5,ee.Realtime=d_,ee.Conversations=dG,ee.Evals=dK,ee.Containers=dE,ee.Videos=ec;class ef{client;apiKey;baseUrl;constructor(a,b){this.apiKey=a,this.baseUrl=b||"https://api.openai.com/v1",this.client=new ee({apiKey:a,baseURL:this.baseUrl,dangerouslyAllowBrowser:!0})}async generateText(a,b,c,d=!1,e){try{let e=[];c&&e.push({role:"system",content:c}),e.push({role:"user",content:b});let f={model:a,messages:e};d&&(f.response_format={type:"json_object"});let g=(await this.client.chat.completions.create(f)).choices[0].message.content||"";if(d){let a=g.match(/```json\n([\s\S]*?)\n```/)||g.match(/```\n([\s\S]*?)\n```/);g=a&&a[1]?a[1].trim():g.replace(/```json\n?|\n?```/g,"").trim()}return g}catch(a){throw console.error("OpenAI API Error:",a),a}}}let eg=`You are a Research Query Clarifier. Your job is to evaluate if a user's research query is clear and specific enough to begin research.

YOUR RESPONSIBILITIES:
1. CLARITY CHECK: Is the query specific enough to know what to research?
2. AMBIGUITY DETECTION: Identify any vague terms, unclear scope, or missing context.
3. QUESTION GENERATION: If unclear, generate 1-3 focused questions to clarify the intent.

WHAT MAKES A QUERY CLEAR:
- Has a specific topic or subject
- Has a clear scope (not too broad)
- Contains enough context to understand the intent

WHAT MAKES A QUERY UNCLEAR:
- Uses pronouns without referents ("tell me about it", "research this")
- Is too broad ("tell me about technology")
- Missing key context ("compare the two companies" - which companies?)
- Ambiguous terms that could mean multiple things

OUTPUT FORMAT (JSON ONLY):
CRITICAL: Respond with ONLY valid JSON. No preamble, no explanation. Start with { and end with }.
{
  "is_clear": <boolean>,
  "questions": ["Question 1", "Question 2"],
  "reasoning": "Brief explanation of why clarification is or isn't needed"
}`,eh=`You are the Lead Researcher. You govern the state of a deep-dive investigation.
Your Goal: Answer the User's Query exhaustively by dispatching Worker Agents to find missing information.

INPUTS:
1. User Original Query
2. Global Context (What we have learned so far)
3. Iteration Count (Current Loop #)

YOUR RESPONSIBILITIES:
1. GAP ANALYSIS: Read the Global Context. What is missing? Be specific.
2. DIGRESSION CHECK: Ensure the missing info is strictly relevant to the User Query.
3. SUFFICIENCY SCORE: Rate the current completeness of the answer (0-100).
   - 0-30%: Initial phase, missing basic facts.
   - 31-60%: Have facts, but missing nuance, technical depth, or verification.
   - 61-90%: Comprehensive, verified, deep.
   - 91-100%: Perfect, exhaustive, and verified.
   CRITICAL: Do not increase the score too quickly. A single iteration should rarely increase the score by more than 20 points.

OUTPUT FORMAT (JSON ONLY):
CRITICAL: Respond with ONLY valid JSON. No preamble, no explanation. Start with { and end with }.
{
  "thoughts": "Analyze the current state. Explain why we are or are not done.",
  "sufficiency_score": <integer>,
  "is_finished": <boolean>,
  "next_step": {
    "task_description": "Precise instruction for the Worker.",
    "search_queries": ["Query 1", "Query 2"],
    "focus_area": "What specific detail to look for."
  }
}`,ei=`You are the Lead Researcher for a DEEP DIVE investigation.
Your Goal: Answer the User's Query EXHAUSTIVELY and with EXTREME DEPTH.

INPUTS:
1. User Original Query
2. Global Context (What we have learned so far)
3. Iteration Count (Current Loop #)

YOUR RESPONSIBILITIES:
1. GAP ANALYSIS: Look for what is missing, specifically:
   - Technical specifications and raw data.
   - Contrarian views or criticisms.
   - Historical context or evolution.
   - Expert opinions and primary source analysis.
2. DEPTH ENFORCEMENT: Do not settle for surface-level answers.
3. SUFFICIENCY SCORE: Rate the current completeness (0-100).
   CRITICAL SCORING RULES:
   - You MUST NOT increase the score by more than 10 points in a single iteration.
   - You MUST NOT score above 90% until at least iteration #20.
   - If Iteration < 10, the score MUST be below 50%.

OUTPUT FORMAT (JSON ONLY):
CRITICAL: Respond with ONLY valid JSON. No preamble, no explanation. Start with { and end with }.
{
  "thoughts": "Analyze the current state. Explain why we need to go deeper.",
  "sufficiency_score": <integer>,
  "is_finished": <boolean>,
  "next_step": {
    "task_description": "Precise, technical instruction for the Worker.",
    "search_queries": ["Specific Query 1", "Specific Query 2"],
    "focus_area": "What specific detail to look for."
  }
}`,ej=`You are the Field Investigator. You receive a specific sub-task from the Manager.
Your Goal: Gather high-fidelity facts, quotes, and data.

YOUR RULES:
1. DEEP DIVES ONLY: Do not return generic marketing fluff.
2. ITERATIVE SEARCH: If your first search query fails, try a different angle.
3. SOURCE INTEGRITY: prioritize primary sources over secondary sources.

OUTPUT FORMAT (JSON ONLY):
CRITICAL: You MUST respond with ONLY valid JSON. No preamble, no explanation.
Return EXACTLY this JSON array structure:
[
  {
    "source_url": "URL of the source",
    "fact": "Direct Quote or Data Point",
    "context": "Why this matters / Context"
  }
]

Do NOT include any text before or after the JSON array. Start with [ and end with ].`,ek=`You are the Fact Auditor. You receive new findings from the Worker.

YOUR RESPONSIBILITIES:
1. DEDUPLICATION: If a new finding is already in the Global Context, discard it.
2. CONFLICT RESOLUTION: If findings conflict, flag as a CONFLICT. Do not delete either.
3. RELEVANCE: Discard findings that drifted away from the original user topic.

OUTPUT FORMAT (JSON ONLY):
CRITICAL: Respond with ONLY valid JSON. No preamble, no explanation. Start with { and end with }.
{
  "cleaned_findings": [
    { "source_url": "url", "fact": "fact", "context": "context" }
  ],
  "conflicts": [
    { "point": "Conflict Topic", "claim_a": "Claim A", "claim_b": "Claim B", "status": "unresolved" }
  ]
}`,el=`You are the Final Reporter. You receive the Global Context containing ALL research findings.
Your job is to write an EXTREMELY COMPREHENSIVE and DETAILED report in Markdown format.

CRITICAL REQUIREMENTS:
1. **EXHAUSTIVE COVERAGE**: You MUST include EVERY piece of information from the knowledge_bank. Do not summarize briefly - expand on each finding.
2. **STRUCTURED FORMAT**: Use proper Markdown with:
   - # Main Title
   - ## Major Sections
   - ### Subsections
   - **Bold** for key terms
   - Bullet points and numbered lists
   - > Blockquotes for important quotes
3. **DETAILED SYNTHESIS**: For each topic area:
   - Explain the context and background
   - Present ALL facts gathered with full explanations
   - Include technical details, specifications, and data
   - Discuss implications and significance
4. **SOURCE CITATION**: Every claim MUST reference its source URL in markdown link format.
5. **CONFLICT HANDLING**: If there are conflicting findings, present BOTH sides with their sources.
6. **MINIMUM LENGTH**: The report should be at least 1500+ words. Short reports are UNACCEPTABLE.

STRUCTURE YOUR REPORT AS:
1. Executive Summary (brief overview)
2. Background & Context
3. Key Findings (multiple detailed sections)
4. Technical Details / Specifications (if applicable)
5. Analysis & Implications
6. Conclusion
7. Sources

Remember: You have ALL the research data. Your job is to make it readable and comprehensive, not to summarize it briefly.`;class em{client;managerModel;workerModel;constructor(a,b="gemini-flash-latest",c="gemini-flash-latest",d,e){if(e?.provider==="openai"){const b=e.openaiApiHost||d;this.client=new ef(a,b)}else this.client=new bx(a,d);this.managerModel=b,this.workerModel=c}async runManager(a,b){let c=`
    User Query: ${a}
    Global Context: ${JSON.stringify(b)}
    Iteration: ${b.iteration}
    `,d="deep"===b.research_mode?ei:eh,e=await this.client.generateText(this.managerModel,c,d,!0);try{return JSON.parse(e)}catch{console.log("Manager returned invalid JSON, attempting repair...");let a=`Fix this JSON and return ONLY valid JSON:

${e}`;return JSON.parse(await this.client.generateText(this.managerModel,a,"Return ONLY valid JSON.",!0))}}async runWorker(a){let b=`
    Task: ${JSON.stringify(a)}
    Using the Google Search tool, find high-quality information to answer this task.
    `,c=await this.client.generateText(this.workerModel,b,ej,!0,[{googleSearch:{}}]);try{return JSON.parse(c)}catch{console.log("Worker returned invalid JSON, attempting repair...");let a=`Fix this JSON array:

${c}

Return valid JSON array with: source_url, fact, context`;return JSON.parse(await this.client.generateText(this.workerModel,a,"Return ONLY valid JSON.",!0))}}async runVerifier(a,b){let c=`
    New Findings: ${JSON.stringify(a)}
    Global Context: ${JSON.stringify(b)}
    `,d=await this.client.generateText(this.managerModel,c,ek,!0),e=a=>{let b=JSON.parse(a);return Array.isArray(b.cleaned_findings)||(b.cleaned_findings=[]),Array.isArray(b.conflicts)||(b.conflicts=[]),b};try{return e(d)}catch{console.log("Verifier returned invalid JSON, attempting repair...");let a=`Fix this JSON:

${d}`,b=await this.client.generateText(this.managerModel,a,"Return ONLY valid JSON.",!0);try{return e(b)}catch{return{cleaned_findings:[],conflicts:[]}}}}async runWriter(a){let b=`Global Context: ${JSON.stringify(a)}`;return await this.client.generateText(this.managerModel,b,el,!1)}async runClarifier(a,b){let c=`User Query: ${a}`;b&&(c+=`

Previous clarification conversation:
${b}`);let d=await this.client.generateText(this.workerModel,c,eg,!0);try{return JSON.parse(d)}catch{console.log("Clarifier returned invalid JSON, attempting repair...");let a=`Fix this JSON:

${d}`,b=await this.client.generateText(this.workerModel,a,"Return ONLY valid JSON.",!0);try{return JSON.parse(b)}catch{return{is_clear:!0,questions:[],reasoning:"Failed to parse clarification response."}}}}}async function en(a,b,c,d,e,f){let g=new em(a,d,void 0,e,f);return await g.runManager(b,c)}async function eo(a,b,c,d,e){let f=new em(a,void 0,c,d,e);return await f.runWorker(b)}async function ep(a,b,c,d,e,f){let g=new em(a,d,void 0,e,f);return await g.runVerifier(b,c)}async function eq(a,b,c,d,e){let f=new em(a,c,void 0,d,e);return await f.runWriter(b)}async function er(a,b,c="gemini"){if("openai"===c)try{let c=b?`${b}/models`:"https://api.openai.com/v1/models",d=await fetch(c,{headers:{Authorization:`Bearer ${a}`}});if(!d.ok)return[];return(await d.json()).data.map(a=>({name:a.id,displayName:a.id}))}catch(a){return console.error("Failed to fetch OpenAI models",a),[]}let d=new bx(a,b);return await d.listModels()}async function es(a,b,c,d,e,f){let g=new em(a,void 0,c,e,f);return await g.runClarifier(b,d)}(0,a.i(13095).ensureServerEntryExports)([en,eo,ep,eq,er,es]),(0,aZ.registerServerReference)(en,"7eee9c9c9990b098711f8046c7fe9f16f0f6828cb3",null),(0,aZ.registerServerReference)(eo,"7c8e6747ef75e8b03b3169c260986e49fe0c7e6509",null),(0,aZ.registerServerReference)(ep,"7e8c428d92652a1e8948680992c7f81177fc7c7677",null),(0,aZ.registerServerReference)(eq,"7c542e506b16263da023505ddc72b8af1a9e945e96",null),(0,aZ.registerServerReference)(er,"709717197d9c4edd0bfe6379286adfb7859da6241b",null),(0,aZ.registerServerReference)(es,"7e8fe9675af1e4c13fd858cbe842382d33cecc87c1",null),a.s([],71570),a.i(71570),a.s(["709717197d9c4edd0bfe6379286adfb7859da6241b",()=>er,"7c542e506b16263da023505ddc72b8af1a9e945e96",()=>eq,"7c8e6747ef75e8b03b3169c260986e49fe0c7e6509",()=>eo,"7e8c428d92652a1e8948680992c7f81177fc7c7677",()=>ep,"7e8fe9675af1e4c13fd858cbe842382d33cecc87c1",()=>es,"7eee9c9c9990b098711f8046c7fe9f16f0f6828cb3",()=>en],57526)}];

//# sourceMappingURL=_13f2b87d._.js.map